<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–¢–µ—Å—Ç —Å –Ω–∞—Å—Ç–æ—è—â–∏–º OAuth —Ç–æ–∫–µ–Ω–æ–º</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 1000px;
            margin: 0 auto;
            padding: 20px;
            background: #1a1a1a;
            color: #fff;
            line-height: 1.6;
        }
        .container {
            background: #2a2a2a;
            padding: 20px;
            border-radius: 10px;
            margin-bottom: 20px;
        }
        .success {
            background: #4caf50;
            color: #fff;
            padding: 15px;
            border-radius: 8px;
            margin: 15px 0;
        }
        .warning {
            background: #ff9800;
            color: #000;
            padding: 15px;
            border-radius: 8px;
            margin: 15px 0;
            font-weight: bold;
        }
        .error {
            background: #f44336;
            color: #fff;
            padding: 15px;
            border-radius: 8px;
            margin: 15px 0;
        }
        .log {
            background: #000;
            color: #0f0;
            padding: 15px;
            border-radius: 5px;
            font-family: monospace;
            white-space: pre-wrap;
            max-height: 600px;
            overflow-y: auto;
            margin-top: 10px;
            font-size: 12px;
            line-height: 1.4;
        }
        .log .error { color: #f44; }
        .log .success { color: #4f4; }
        .log .info { color: #4af; }
        .log .warning { color: #ff9; }
        button {
            background: #4fc3f7;
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 5px;
            cursor: pointer;
            margin: 5px;
            font-size: 14px;
        }
        button:hover {
            background: #29b6f6;
        }
        button:disabled {
            background: #666;
            cursor: not-allowed;
        }
        .stats {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin: 20px 0;
        }
        .stat-card {
            background: #333;
            padding: 15px;
            border-radius: 8px;
            text-align: center;
        }
        .stat-number {
            font-size: 2em;
            font-weight: bold;
            color: #4fc3f7;
        }
        .track-example {
            background: #333;
            padding: 10px;
            margin: 5px 0;
            border-radius: 5px;
            border-left: 4px solid #4fc3f7;
        }
    </style>
</head>
<body>
    <h1>üéµ –¢–µ—Å—Ç —Å –Ω–∞—Å—Ç–æ—è—â–∏–º OAuth —Ç–æ–∫–µ–Ω–æ–º</h1>
    
    <div class="success">
        ‚úÖ –ò—Å–ø–æ–ª—å–∑—É–µ–º —Ä–∞–±–æ—á–∏–π OAuth —Ç–æ–∫–µ–Ω: y0_AgAAAAAj2vgeAAG8XgAAAAEJa-6RAAAdPHm_OlpI_4ludZXEeCSbWupQkA
    </div>

    <div class="container">
        <h2>üöÄ –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ</h2>
        <button onclick="runFullTest()">üî¨ –ü–æ–ª–Ω—ã–π —Ç–µ—Å—Ç API</button>
        <button onclick="testOurAPI()">üåê –¢–µ—Å—Ç –Ω–∞—à–µ–≥–æ Vercel API</button>
        <button onclick="simulateProcessing()">‚öôÔ∏è –°–∏–º—É–ª—è—Ü–∏—è –æ–±—Ä–∞–±–æ—Ç–∫–∏ —Ç—Ä–µ–∫–æ–≤</button>
        <button onclick="clearLog()">üóëÔ∏è –û—á–∏—Å—Ç–∏—Ç—å –ª–æ–≥</button>
    </div>

    <div class="container">
        <h2>üìä –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞</h2>
        <div id="stats" class="stats">
            <div class="stat-card">
                <div class="stat-number" id="totalTracks">-</div>
                <div>–í—Å–µ–≥–æ —Ç—Ä–µ–∫–æ–≤</div>
            </div>
            <div class="stat-card">
                <div class="stat-number" id="availableTracks">-</div>
                <div>–î–æ—Å—Ç—É–ø–Ω—ã—Ö</div>
            </div>
            <div class="stat-card">
                <div class="stat-number" id="processedTracks">-</div>
                <div>–ü–æ—Å–ª–µ –æ–±—Ä–∞–±–æ—Ç–∫–∏</div>
            </div>
            <div class="stat-card">
                <div class="stat-number" id="successRate">-</div>
                <div>–£—Å–ø–µ—à–Ω–æ—Å—Ç—å</div>
            </div>
        </div>
    </div>

    <div class="container">
        <h2>üéº –ü—Ä–∏–º–µ—Ä—ã —Ç—Ä–µ–∫–æ–≤</h2>
        <div id="trackExamples">
            <p>–ó–∞–ø—É—Å—Ç–∏—Ç–µ —Ç–µ—Å—Ç –¥–ª—è –ø—Ä–æ—Å–º–æ—Ç—Ä–∞ –ø—Ä–∏–º–µ—Ä–æ–≤ —Ç—Ä–µ–∫–æ–≤</p>
        </div>
    </div>

    <div class="container">
        <h2>üìù –õ–æ–≥ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è</h2>
        <div id="log" class="log">–ì–æ—Ç–æ–≤ –∫ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—é —Å –Ω–∞—Å—Ç–æ—è—â–∏–º OAuth —Ç–æ–∫–µ–Ω–æ–º...\n</div>
    </div>

    <script>
        // –ù–∞—Å—Ç–æ—è—â–∏–π OAuth —Ç–æ–∫–µ–Ω
        const OAUTH_TOKEN = 'y0_AgAAAAAj2vgeAAG8XgAAAAEJa-6RAAAdPHm_OlpI_4ludZXEeCSbWupQkA';
        
        let globalTrackData = null;

        function log(message, type = 'info') {
            const logDiv = document.getElementById('log');
            const timestamp = new Date().toLocaleTimeString();
            const className = type === 'error' ? 'error' : type === 'success' ? 'success' : type === 'warning' ? 'warning' : 'info';
            logDiv.innerHTML += `<span class="${className}">[${timestamp}] ${message}</span>\n`;
            logDiv.scrollTop = logDiv.scrollHeight;
        }

        function clearLog() {
            document.getElementById('log').innerHTML = '–õ–æ–≥ –æ—á–∏—â–µ–Ω...\n';
            updateStats(0, 0, 0);
            document.getElementById('trackExamples').innerHTML = '<p>–ó–∞–ø—É—Å—Ç–∏—Ç–µ —Ç–µ—Å—Ç –¥–ª—è –ø—Ä–æ—Å–º–æ—Ç—Ä–∞ –ø—Ä–∏–º–µ—Ä–æ–≤ —Ç—Ä–µ–∫–æ–≤</p>';
        }

        function updateStats(total, available, processed) {
            document.getElementById('totalTracks').textContent = total;
            document.getElementById('availableTracks').textContent = available;
            document.getElementById('processedTracks').textContent = processed;
            document.getElementById('successRate').textContent = total > 0 ? Math.round((processed / total) * 100) + '%' : '-';
        }

        function showTrackExamples(tracks) {
            const container = document.getElementById('trackExamples');
            if (!tracks || tracks.length === 0) {
                container.innerHTML = '<p>‚ùå –ù–µ—Ç —Ç—Ä–µ–∫–æ–≤ –¥–ª—è –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è</p>';
                return;
            }

            const examples = tracks.slice(0, 5).map((track, index) => `
                <div class="track-example">
                    <strong>${index + 1}. ${track.title || '–ë–µ–∑ –Ω–∞–∑–≤–∞–Ω–∏—è'}</strong><br>
                    <small>
                        üë§ ${track.artists?.map(a => a.name).join(', ') || '–ù–µ–∏–∑–≤–µ—Å—Ç–Ω—ã–π –∏—Å–ø–æ–ª–Ω–∏—Ç–µ–ª—å'}<br>
                        üíø ${track.albums?.[0]?.title || '–ù–µ–∏–∑–≤–µ—Å—Ç–Ω—ã–π –∞–ª—å–±–æ–º'}<br>
                        ‚è±Ô∏è ${Math.floor((track.durationMs || 0) / 1000)}—Å | 
                        ${track.available ? '‚úÖ –î–æ—Å—Ç—É–ø–µ–Ω' : '‚ùå –ù–µ–¥–æ—Å—Ç—É–ø–µ–Ω'}
                    </small>
                </div>
            `).join('');

            container.innerHTML = `
                <h4>–ü—Ä–∏–º–µ—Ä—ã —Ç—Ä–µ–∫–æ–≤ (–ø–µ—Ä–≤—ã–µ 5 –∏–∑ ${tracks.length}):</h4>
                ${examples}
            `;
        }

        async function runFullTest() {
            log('üöÄ –ù–∞—á–∏–Ω–∞–µ–º –ø–æ–ª–Ω—ã–π —Ç–µ—Å—Ç —Å –Ω–∞—Å—Ç–æ—è—â–∏–º OAuth —Ç–æ–∫–µ–Ω–æ–º', 'success');
            log(`–¢–æ–∫–µ–Ω: ${OAUTH_TOKEN.substring(0, 20)}...`, 'info');

            const headers = {
                'Authorization': `OAuth ${OAUTH_TOKEN}`,
                'User-Agent': 'Yandex-Music-API/1.0',
                'Content-Type': 'application/json'
            };

            try {
                // –¢–µ—Å—Ç 1: –ê—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è
                log('üìã –®–∞–≥ 1: –ü—Ä–æ–≤–µ—Ä–∫–∞ –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏...', 'info');
                const userResponse = await fetch('https://api.music.yandex.net/account/status', {
                    method: 'GET',
                    headers: headers
                });

                log(`–°—Ç–∞—Ç—É—Å –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏: ${userResponse.status}`, userResponse.ok ? 'success' : 'error');

                if (!userResponse.ok) {
                    const errorData = await userResponse.json().catch(() => userResponse.text());
                    log(`‚ùå –û—à–∏–±–∫–∞ –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏: ${JSON.stringify(errorData)}`, 'error');
                    return;
                }

                const userData = await userResponse.json();
                const userId = userData.result?.account?.uid;
                log(`‚úÖ –£—Å–ø–µ—à–Ω–∞—è –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è! User ID: ${userId}`, 'success');
                log(`–ê–∫–∫–∞—É–Ω—Ç: ${userData.result?.account?.login || '–ù–µ–∏–∑–≤–µ—Å—Ç–Ω–æ'}`, 'info');

                // –¢–µ—Å—Ç 2: –ü–æ–ª—É—á–µ–Ω–∏–µ –ª–∞–π–∫–æ–≤
                log('‚ù§Ô∏è –®–∞–≥ 2: –ü–æ–ª—É—á–µ–Ω–∏–µ –ª–∞–π–∫–Ω—É—Ç—ã—Ö —Ç—Ä–µ–∫–æ–≤...', 'info');
                const likesResponse = await fetch(`https://api.music.yandex.net/users/${userId}/likes/tracks`, {
                    method: 'GET',
                    headers: headers
                });

                log(`–°—Ç–∞—Ç—É—Å –ø–æ–ª—É—á–µ–Ω–∏—è –ª–∞–π–∫–æ–≤: ${likesResponse.status}`, likesResponse.ok ? 'success' : 'error');

                if (!likesResponse.ok) {
                    const errorData = await likesResponse.json().catch(() => likesResponse.text());
                    log(`‚ùå –û—à–∏–±–∫–∞ –ø–æ–ª—É—á–µ–Ω–∏—è –ª–∞–π–∫–æ–≤: ${JSON.stringify(errorData)}`, 'error');
                    return;
                }

                const likesData = await likesResponse.json();
                const trackIds = likesData.result?.library?.tracks?.map(track => track.id) || [];
                log(`‚úÖ –ù–∞–π–¥–µ–Ω–æ –ª–∞–π–∫–Ω—É—Ç—ã—Ö —Ç—Ä–µ–∫–æ–≤: ${trackIds.length}`, 'success');

                if (trackIds.length === 0) {
                    log('‚ö†Ô∏è –£ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –Ω–µ—Ç –ª–∞–π–∫–Ω—É—Ç—ã—Ö —Ç—Ä–µ–∫–æ–≤', 'warning');
                    return;
                }

                // –¢–µ—Å—Ç 3: –ü–æ–ª—É—á–µ–Ω–∏–µ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏ –æ —Ç—Ä–µ–∫–∞—Ö (–±–∞—Ç—á–∞–º–∏)
                log('üéµ –®–∞–≥ 3: –ü–æ–ª—É—á–µ–Ω–∏–µ –ø–æ–ª–Ω–æ–π –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏ –æ —Ç—Ä–µ–∫–∞—Ö...', 'info');
                log('–ó–∞–≥—Ä—É–∂–∞–µ–º —Ç—Ä–µ–∫–∏ –±–∞—Ç—á–∞–º–∏ –ø–æ 100...', 'info');

                const batchSize = 100;
                const allTracks = [];
                const totalBatches = Math.ceil(trackIds.length / batchSize);

                for (let i = 0; i < trackIds.length; i += batchSize) {
                    const batch = trackIds.slice(i, i + batchSize);
                    const batchNum = Math.floor(i / batchSize) + 1;
                    
                    log(`–û–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ–º –±–∞—Ç—á ${batchNum}/${totalBatches} (—Ç—Ä–µ–∫–∏ ${i + 1}-${Math.min(i + batchSize, trackIds.length)})`, 'info');

                    const tracksResponse = await fetch('https://api.music.yandex.net/tracks', {
                        method: 'POST',
                        headers: headers,
                        body: JSON.stringify({
                            'track-ids': batch,
                            'with-positions': false
                        })
                    });

                    if (tracksResponse.ok) {
                        const tracksData = await tracksResponse.json();
                        const batchTracks = tracksData.result || [];
                        allTracks.push(...batchTracks);
                        log(`‚úÖ –ë–∞—Ç—á ${batchNum}: –ø–æ–ª—É—á–µ–Ω–æ ${batchTracks.length} —Ç—Ä–µ–∫–æ–≤`, 'success');
                    } else {
                        log(`‚ùå –û—à–∏–±–∫–∞ –≤ –±–∞—Ç—á–µ ${batchNum}: —Å—Ç–∞—Ç—É—Å ${tracksResponse.status}`, 'error');
                    }

                    // –ù–µ–±–æ–ª—å—à–∞—è –ø–∞—É–∑–∞ –º–µ–∂–¥—É –∑–∞–ø—Ä–æ—Å–∞–º–∏
                    if (i + batchSize < trackIds.length) {
                        await new Promise(resolve => setTimeout(resolve, 100));
                    }
                }

                globalTrackData = allTracks;
                log(`üéâ –ó–∞–≥—Ä—É–∑–∫–∞ –∑–∞–≤–µ—Ä—à–µ–Ω–∞! –ü–æ–ª—É—á–µ–Ω–æ ${allTracks.length} —Ç—Ä–µ–∫–æ–≤ –∏–∑ ${trackIds.length} –ª–∞–π–∫–æ–≤`, 'success');

                // –ê–Ω–∞–ª–∏–∑ —Ç—Ä–µ–∫–æ–≤
                log('üìä –ê–Ω–∞–ª–∏–∑ –ø–æ–ª—É—á–µ–Ω–Ω—ã—Ö —Ç—Ä–µ–∫–æ–≤...', 'info');
                const availableCount = allTracks.filter(t => t.available).length;
                const unavailableCount = allTracks.filter(t => !t.available).length;
                const withTitleCount = allTracks.filter(t => t.title).length;
                const withArtistsCount = allTracks.filter(t => t.artists && t.artists.length > 0).length;

                log(`–í—Å–µ–≥–æ —Ç—Ä–µ–∫–æ–≤: ${allTracks.length}`, 'info');
                log(`–î–æ—Å—Ç—É–ø–Ω—ã—Ö: ${availableCount} (${Math.round(availableCount/allTracks.length*100)}%)`, availableCount > 0 ? 'success' : 'warning');
                log(`–ù–µ–¥–æ—Å—Ç—É–ø–Ω—ã—Ö: ${unavailableCount} (${Math.round(unavailableCount/allTracks.length*100)}%)`, 'info');
                log(`–° –Ω–∞–∑–≤–∞–Ω–∏–µ–º: ${withTitleCount}`, 'info');
                log(`–° –∏—Å–ø–æ–ª–Ω–∏—Ç–µ–ª—è–º–∏: ${withArtistsCount}`, 'info');

                // –û–±–Ω–æ–≤–ª—è–µ–º —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É
                updateStats(allTracks.length, availableCount, 0);
                showTrackExamples(allTracks);

                // –¢–µ—Å—Ç –æ–±—Ä–∞–±–æ—Ç–∫–∏
                log('‚öôÔ∏è –®–∞–≥ 4: –°–∏–º—É–ª—è—Ü–∏—è –æ–±—Ä–∞–±–æ—Ç–∫–∏ —Ç—Ä–µ–∫–æ–≤ (–∫–∞–∫ –≤ –Ω–∞—à–µ–º API)...', 'info');
                await simulateProcessingInternal(allTracks);

            } catch (error) {
                log(`‚ùå –ö—Ä–∏—Ç–∏—á–µ—Å–∫–∞—è –æ—à–∏–±–∫–∞: ${error.message}`, 'error');
                console.error('–ü–æ–ª–Ω–∞—è –æ—à–∏–±–∫–∞:', error);
            }
        }

        async function simulateProcessingInternal(tracks) {
            if (!tracks) {
                log('‚ùå –ù–µ—Ç –¥–∞–Ω–Ω—ã—Ö –¥–ª—è –æ–±—Ä–∞–±–æ—Ç–∫–∏', 'error');
                return;
            }

            log('üîÑ –°–∏–º—É–ª–∏—Ä—É–µ–º –æ–±—Ä–∞–±–æ—Ç–∫—É —Ç—Ä–µ–∫–æ–≤ –∫–∞–∫ –≤ –Ω–∞—à–µ–º API...', 'info');

            // –¢–æ—á–Ω–æ —Ç–∞–∫–∞—è –∂–µ –ª–æ–≥–∏–∫–∞, –∫–∞–∫ –≤ api/getYandexData.ts
            const processedTracks = tracks
                .map((track) => {
                    const processed = {
                        id: String(track.id),
                        title: track.title || 'Unknown Title',
                        artist: track.artists?.map((a) => a.name).join(', ') || 'Unknown Artist',
                        album: track.albums?.[0]?.title || 'Unknown Album',
                        duration: Math.floor((track.durationMs || 0) / 1000),
                        genre: track.albums?.[0]?.genre || 'unknown',
                        cover_url: track.coverUri ? `https://${track.coverUri.replace('%%', '400x400')}` : undefined,
                        preview_url: undefined,
                        available: track.available !== false,
                    };
                    return processed;
                })
                .filter((track) => track.title && track.artist);

            log(`–†–µ–∑—É–ª—å—Ç–∞—Ç –æ–±—Ä–∞–±–æ—Ç–∫–∏:`, 'info');
            log(`  –ò—Å—Ö–æ–¥–Ω—ã—Ö —Ç—Ä–µ–∫–æ–≤: ${tracks.length}`, 'info');
            log(`  –ü–æ—Å–ª–µ –æ–±—Ä–∞–±–æ—Ç–∫–∏: ${processedTracks.length}`, processedTracks.length > 0 ? 'success' : 'error');
            log(`  –û—Ç—Ñ–∏–ª—å—Ç—Ä–æ–≤–∞–Ω–æ: ${tracks.length - processedTracks.length}`, 'info');

            // –û–±–Ω–æ–≤–ª—è–µ–º —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É
            const availableCount = tracks.filter(t => t.available).length;
            updateStats(tracks.length, availableCount, processedTracks.length);

            if (processedTracks.length === 0) {
                log('‚ùå –ü–†–û–ë–õ–ï–ú–ê: –ü–æ—Å–ª–µ –æ–±—Ä–∞–±–æ—Ç–∫–∏ –Ω–µ –æ—Å—Ç–∞–ª–æ—Å—å —Ç—Ä–µ–∫–æ–≤!', 'error');
                log('–ê–Ω–∞–ª–∏–∑–∏—Ä—É–µ–º –ø—Ä–∏—á–∏–Ω—ã...', 'warning');
                
                const noTitle = tracks.filter(t => !t.title).length;
                const noArtists = tracks.filter(t => !t.artists || t.artists.length === 0).length;
                
                log(`  –¢—Ä–µ–∫–æ–≤ –±–µ–∑ –Ω–∞–∑–≤–∞–Ω–∏—è: ${noTitle}`, 'warning');
                log(`  –¢—Ä–µ–∫–æ–≤ –±–µ–∑ –∏—Å–ø–æ–ª–Ω–∏—Ç–µ–ª–µ–π: ${noArtists}`, 'warning');
                
                if (tracks.length > 0) {
                    log('–ü—Ä–∏–º–µ—Ä –ø–µ—Ä–≤–æ–≥–æ —Ç—Ä–µ–∫–∞:', 'info');
                    log(JSON.stringify(tracks[0], null, 2), 'info');
                }
            } else {
                log('‚úÖ –û–±—Ä–∞–±–æ—Ç–∫–∞ —É—Å–ø–µ—à–Ω–∞!', 'success');
                log('–ü—Ä–∏–º–µ—Ä—ã –æ–±—Ä–∞–±–æ—Ç–∞–Ω–Ω—ã—Ö —Ç—Ä–µ–∫–æ–≤:', 'info');
                processedTracks.slice(0, 3).forEach((track, index) => {
                    log(`  ${index + 1}. "${track.title}" - ${track.artist}`, 'info');
                });
            }

            return processedTracks;
        }

        async function simulateProcessing() {
            if (!globalTrackData) {
                log('‚ùå –°–Ω–∞—á–∞–ª–∞ –∑–∞–ø—É—Å—Ç–∏—Ç–µ –ø–æ–ª–Ω—ã–π —Ç–µ—Å—Ç –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è –¥–∞–Ω–Ω—ã—Ö', 'error');
                return;
            }

            await simulateProcessingInternal(globalTrackData);
        }

        async function testOurAPI() {
            log('üåê –¢–µ—Å—Ç–∏—Ä—É–µ–º –Ω–∞—à Vercel API —Å –Ω–∞—Å—Ç–æ—è—â–∏–º —Ç–æ–∫–µ–Ω–æ–º...', 'info');

            try {
                const response = await fetch('/api/getYandexData', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({ token: OAUTH_TOKEN })
                });

                log(`–°—Ç–∞—Ç—É—Å –Ω–∞—à–µ–≥–æ API: ${response.status}`, response.ok ? 'success' : 'error');

                if (!response.ok) {
                    const errorData = await response.json().catch(() => ({}));
                    log(`‚ùå –û—à–∏–±–∫–∞ –Ω–∞—à–µ–≥–æ API: ${JSON.stringify(errorData, null, 2)}`, 'error');
                    return;
                }

                const data = await response.json();
                log('‚úÖ –ù–∞—à API —Ä–∞–±–æ—Ç–∞–µ—Ç!', 'success');
                log(`–ü–æ–ª—É—á–µ–Ω–æ —Ç—Ä–µ–∫–æ–≤: ${data.tracks?.length || 0}`, 'success');
                log(`–ò—Å—Ç–æ—á–Ω–∏–∫: ${data.metadata?.source}`, 'info');
                log(`–í—Ä–µ–º—è –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏: ${data.metadata?.generated_at}`, 'info');

                if (data.tracks && data.tracks.length > 0) {
                    log('–ü—Ä–∏–º–µ—Ä —Ç—Ä–µ–∫–∞ –∏–∑ –Ω–∞—à–µ–≥–æ API:', 'info');
                    log(JSON.stringify(data.tracks[0], null, 2), 'info');
                    
                    const tracksWithPreview = data.tracks.filter(t => t.preview_url).length;
                    log(`–¢—Ä–µ–∫–æ–≤ —Å –ø—Ä–µ–≤—å—é: ${tracksWithPreview}`, 'info');
                    
                    updateStats(data.tracks.length, data.tracks.filter(t => t.available).length, data.tracks.length);
                } else {
                    log('‚ùå –ù–∞—à API –Ω–µ –≤–µ—Ä–Ω—É–ª —Ç—Ä–µ–∫–æ–≤!', 'error');
                }

            } catch (error) {
                log(`‚ùå –û—à–∏–±–∫–∞ –≤—ã–∑–æ–≤–∞ –Ω–∞—à–µ–≥–æ API: ${error.message}`, 'error');
            }
        }

        // –ê–≤—Ç–æ–∑–∞–ø—É—Å–∫ –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ
        window.addEventListener('load', () => {
            log('‚úÖ –°—Ç—Ä–∞–Ω–∏—Ü–∞ –∑–∞–≥—Ä—É–∂–µ–Ω–∞ —Å –Ω–∞—Å—Ç–æ—è—â–∏–º OAuth —Ç–æ–∫–µ–Ω–æ–º', 'success');
            log('–ì–æ—Ç–æ–≤ –∫ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—é!', 'info');
        });
    </script>
</body>
</html>
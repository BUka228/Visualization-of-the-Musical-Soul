<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–¢–µ—Å—Ç DataProcessor</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 20px;
            background: #1a1a1a;
            color: #ffffff;
        }
        .container {
            max-width: 1200px;
            margin: 0 auto;
        }
        .test-section {
            margin: 20px 0;
            padding: 20px;
            background: #2a2a2a;
            border-radius: 8px;
        }
        .test-result {
            margin: 10px 0;
            padding: 10px;
            border-radius: 4px;
        }
        .success {
            background: #2d5a2d;
            border-left: 4px solid #4caf50;
        }
        .error {
            background: #5a2d2d;
            border-left: 4px solid #f44336;
        }
        .info {
            background: #2d3a5a;
            border-left: 4px solid #2196f3;
        }
        .genre-color {
            display: inline-block;
            width: 20px;
            height: 20px;
            margin-right: 10px;
            border-radius: 3px;
            vertical-align: middle;
        }
        .track-item {
            margin: 5px 0;
            padding: 10px;
            background: #3a3a3a;
            border-radius: 4px;
            font-size: 14px;
        }
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin: 15px 0;
        }
        .stat-card {
            background: #3a3a3a;
            padding: 15px;
            border-radius: 6px;
        }
        .stat-value {
            font-size: 24px;
            font-weight: bold;
            color: #4caf50;
        }
        .stat-label {
            font-size: 14px;
            color: #cccccc;
        }
        pre {
            background: #1e1e1e;
            padding: 15px;
            border-radius: 4px;
            overflow-x: auto;
            font-size: 12px;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>üß™ –¢–µ—Å—Ç –º–æ–¥—É–ª—è DataProcessor</h1>
        
        <div class="test-section">
            <h2>üìä –†–µ–∑—É–ª—å—Ç–∞—Ç—ã —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è</h2>
            <div id="test-results"></div>
        </div>

        <div class="test-section">
            <h2>üéµ –û–±—Ä–∞–±–æ—Ç–∞–Ω–Ω—ã–µ —Ç—Ä–µ–∫–∏</h2>
            <div id="processed-tracks"></div>
        </div>

        <div class="test-section">
            <h2>üìà –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –∂–∞–Ω—Ä–æ–≤</h2>
            <div id="genre-stats"></div>
        </div>

        <div class="test-section">
            <h2>üîç –î–µ—Ç–∞–ª—å–Ω–∞—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞</h2>
            <div id="processing-stats"></div>
        </div>
    </div>

    <script type="module">
        import { DataProcessor } from './src/data/DataProcessor.js';
        import { Vector3 } from 'three';

        // –°–æ–∑–¥–∞–µ–º —Ç–µ—Å—Ç–æ–≤—ã–µ –¥–∞–Ω–Ω—ã–µ
        const testTracks = [
            {
                id: '1',
                name: 'Bohemian Rhapsody',
                artist: 'Queen',
                album: 'A Night at the Opera',
                genre: 'rock',
                duration: 355,
                popularity: 95,
                previewUrl: 'https://example.com/preview1.mp3'
            },
            {
                id: '2',
                name: 'Master of Puppets',
                artist: 'Metallica',
                album: 'Master of Puppets',
                genre: 'metal',
                duration: 515,
                popularity: 88,
                previewUrl: 'https://example.com/preview2.mp3'
            },
            {
                id: '3',
                name: 'Radioactive',
                artist: 'Imagine Dragons',
                album: 'Night Visions',
                genre: 'indie',
                duration: 187,
                popularity: 92,
                previewUrl: 'https://example.com/preview3.mp3'
            },
            {
                id: '4',
                name: 'Shape of You',
                artist: 'Ed Sheeran',
                album: '√∑ (Divide)',
                genre: 'pop',
                duration: 233,
                popularity: 96,
                previewUrl: 'https://example.com/preview4.mp3'
            },
            {
                id: '5',
                name: 'Strobe',
                artist: 'Deadmau5',
                album: 'For Lack of a Better Name',
                genre: 'electronic',
                duration: 645,
                popularity: 75,
                previewUrl: 'https://example.com/preview5.mp3'
            },
            {
                id: '6',
                name: 'Take Five',
                artist: 'Dave Brubeck',
                album: 'Time Out',
                genre: 'jazz',
                duration: 324,
                popularity: 70,
                previewUrl: 'https://example.com/preview6.mp3'
            }
        ];

        // –¢–µ—Å—Ç–æ–≤—ã–µ –¥–∞–Ω–Ω—ã–µ –∏–∑ –Ø–Ω–¥–µ–∫—Å.–ú—É–∑—ã–∫–∏
        const yandexTestTracks = [
            {
                id: 'y1',
                title: '–ì—Ä—É–ø–ø–∞ –∫—Ä–æ–≤–∏',
                artist: '–ö–∏–Ω–æ',
                album: '–ì—Ä—É–ø–ø–∞ –∫—Ä–æ–≤–∏',
                duration: 278,
                genre: '—Ä–æ–∫',
                available: true,
                cover_url: 'https://example.com/cover1.jpg',
                preview_url: 'https://example.com/preview_y1.mp3'
            },
            {
                id: 'y2',
                title: '–í–ª–∞–¥–∏–º–∏—Ä—Å–∫–∏–π —Ü–µ–Ω—Ç—Ä–∞–ª',
                artist: '–ú–∏—Ö–∞–∏–ª –ö—Ä—É–≥',
                album: '–í–ª–∞–¥–∏–º–∏—Ä—Å–∫–∏–π —Ü–µ–Ω—Ç—Ä–∞–ª',
                duration: 245,
                genre: '—à–∞–Ω—Å–æ–Ω',
                available: true,
                cover_url: 'https://example.com/cover2.jpg',
                preview_url: null
            },
            {
                id: 'y3',
                title: '–ù–µ–¥–æ—Å—Ç—É–ø–Ω—ã–π —Ç—Ä–µ–∫',
                artist: '–ù–µ–∏–∑–≤–µ—Å—Ç–Ω—ã–π –∏—Å–ø–æ–ª–Ω–∏—Ç–µ–ª—å',
                album: '–ù–µ–∏–∑–≤–µ—Å—Ç–Ω—ã–π –∞–ª—å–±–æ–º',
                duration: 200,
                genre: '–ø–æ–ø',
                available: false
            }
        ];

        function runTests() {
            const resultsDiv = document.getElementById('test-results');
            const tracksDiv = document.getElementById('processed-tracks');
            const genreStatsDiv = document.getElementById('genre-stats');
            const processingStatsDiv = document.getElementById('processing-stats');
            
            const processor = new DataProcessor();
            let testsPassed = 0;
            let totalTests = 0;

            function addResult(message, success, details = '') {
                totalTests++;
                if (success) testsPassed++;
                
                const div = document.createElement('div');
                div.className = `test-result ${success ? 'success' : 'error'}`;
                div.innerHTML = `
                    <strong>${success ? '‚úÖ' : '‚ùå'} ${message}</strong>
                    ${details ? `<br><small>${details}</small>` : ''}
                `;
                resultsDiv.appendChild(div);
            }

            function addInfo(message) {
                const div = document.createElement('div');
                div.className = 'test-result info';
                div.innerHTML = `<strong>‚ÑπÔ∏è ${message}</strong>`;
                resultsDiv.appendChild(div);
            }

            try {
                addInfo('–ù–∞—á–∏–Ω–∞–µ–º —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ DataProcessor...');

                // –¢–µ—Å—Ç 1: –°–æ–∑–¥–∞–Ω–∏–µ —ç–∫–∑–µ–º–ø–ª—è—Ä–∞
                try {
                    const testProcessor = new DataProcessor();
                    addResult('–°–æ–∑–¥–∞–Ω–∏–µ —ç–∫–∑–µ–º–ø–ª—è—Ä–∞ DataProcessor', true);
                } catch (error) {
                    addResult('–°–æ–∑–¥–∞–Ω–∏–µ —ç–∫–∑–µ–º–ø–ª—è—Ä–∞ DataProcessor', false, error.message);
                }

                // –¢–µ—Å—Ç 2: –û–±—Ä–∞–±–æ—Ç–∫–∞ —Ç—Ä–µ–∫–æ–≤
                try {
                    const processedTracks = processor.processTrackData(testTracks);
                    const success = processedTracks.length === testTracks.length;
                    addResult('–û–±—Ä–∞–±–æ—Ç–∫–∞ —Ç—Ä–µ–∫–æ–≤', success, 
                        `–û–±—Ä–∞–±–æ—Ç–∞–Ω–æ ${processedTracks.length} –∏–∑ ${testTracks.length} —Ç—Ä–µ–∫–æ–≤`);
                    
                    if (success) {
                        // –û—Ç–æ–±—Ä–∞–∂–∞–µ–º –æ–±—Ä–∞–±–æ—Ç–∞–Ω–Ω—ã–µ —Ç—Ä–µ–∫–∏
                        tracksDiv.innerHTML = processedTracks.map(track => `
                            <div class="track-item">
                                <div style="display: flex; align-items: center; margin-bottom: 5px;">
                                    <div class="genre-color" style="background-color: ${track.color}"></div>
                                    <strong>${track.name}</strong> - ${track.artist}
                                </div>
                                <div style="font-size: 12px; color: #cccccc;">
                                    –ñ–∞–Ω—Ä: ${track.genre} | –ü–æ–ø—É–ª—è—Ä–Ω–æ—Å—Ç—å: ${track.popularity} | –†–∞–∑–º–µ—Ä: ${track.size} | 
                                    –ü–æ–∑–∏—Ü–∏—è: (${track.position.x.toFixed(1)}, ${track.position.y.toFixed(1)}, ${track.position.z.toFixed(1)})
                                </div>
                            </div>
                        `).join('');
                    }
                } catch (error) {
                    addResult('–û–±—Ä–∞–±–æ—Ç–∫–∞ —Ç—Ä–µ–∫–æ–≤', false, error.message);
                }

                // –¢–µ—Å—Ç 3: –ê–Ω–∞–ª–∏–∑ –∂–∞–Ω—Ä–æ–≤
                try {
                    const genreStats = processor.analyzeGenres(testTracks);
                    const genreCount = Object.keys(genreStats).length;
                    const success = genreCount > 0;
                    addResult('–ê–Ω–∞–ª–∏–∑ –∂–∞–Ω—Ä–æ–≤', success, 
                        `–ù–∞–π–¥–µ–Ω–æ ${genreCount} –∂–∞–Ω—Ä–æ–≤`);
                    
                    if (success) {
                        // –û—Ç–æ–±—Ä–∞–∂–∞–µ–º —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É –∂–∞–Ω—Ä–æ–≤
                        genreStatsDiv.innerHTML = Object.entries(genreStats).map(([genre, stats]) => `
                            <div class="track-item">
                                <div style="display: flex; align-items: center; justify-content: space-between;">
                                    <div style="display: flex; align-items: center;">
                                        <div class="genre-color" style="background-color: ${stats.color}"></div>
                                        <strong>${genre}</strong>
                                    </div>
                                    <div>
                                        ${stats.count} —Ç—Ä–µ–∫–æ–≤ (${stats.percentage}%)
                                    </div>
                                </div>
                            </div>
                        `).join('');
                    }
                } catch (error) {
                    addResult('–ê–Ω–∞–ª–∏–∑ –∂–∞–Ω—Ä–æ–≤', false, error.message);
                }

                // –¢–µ—Å—Ç 4: –í—ã—á–∏—Å–ª–µ–Ω–∏–µ –ø–æ–ø—É–ª—è—Ä–Ω–æ—Å—Ç–∏
                try {
                    const popularity = processor.calculatePopularity(testTracks[0]);
                    const success = popularity >= 0 && popularity <= 100;
                    addResult('–í—ã—á–∏—Å–ª–µ–Ω–∏–µ –ø–æ–ø—É–ª—è—Ä–Ω–æ—Å—Ç–∏', success, 
                        `–ü–æ–ø—É–ª—è—Ä–Ω–æ—Å—Ç—å: ${popularity}`);
                } catch (error) {
                    addResult('–í—ã—á–∏—Å–ª–µ–Ω–∏–µ –ø–æ–ø—É–ª—è—Ä–Ω–æ—Å—Ç–∏', false, error.message);
                }

                // –¢–µ—Å—Ç 5: –í—ã—á–∏—Å–ª–µ–Ω–∏–µ —Ä–∞–∑–º–µ—Ä–∞
                try {
                    const size = processor.calculateSize(testTracks[0]);
                    const success = size >= 0.5 && size <= 3.0;
                    addResult('–í—ã—á–∏—Å–ª–µ–Ω–∏–µ —Ä–∞–∑–º–µ—Ä–∞', success, 
                        `–†–∞–∑–º–µ—Ä: ${size}`);
                } catch (error) {
                    addResult('–í—ã—á–∏—Å–ª–µ–Ω–∏–µ —Ä–∞–∑–º–µ—Ä–∞', false, error.message);
                }

                // –¢–µ—Å—Ç 6: –í—ã—á–∏—Å–ª–µ–Ω–∏–µ –ø–æ–∑–∏—Ü–∏–∏
                try {
                    const position = processor.calculatePosition(0, 10, 'rock');
                    const success = position instanceof Vector3;
                    addResult('–í—ã—á–∏—Å–ª–µ–Ω–∏–µ –ø–æ–∑–∏—Ü–∏–∏', success, 
                        `–ü–æ–∑–∏—Ü–∏—è: (${position.x.toFixed(2)}, ${position.y.toFixed(2)}, ${position.z.toFixed(2)})`);
                } catch (error) {
                    addResult('–í—ã—á–∏—Å–ª–µ–Ω–∏–µ –ø–æ–∑–∏—Ü–∏–∏', false, error.message);
                }

                // –¢–µ—Å—Ç 7: –ü–æ–ª—É—á–µ–Ω–∏–µ —Ü–≤–µ—Ç–∞ –∂–∞–Ω—Ä–∞
                try {
                    const color = processor.getGenreColor('rock');
                    const success = color.startsWith('#') && color.length === 7;
                    addResult('–ü–æ–ª—É—á–µ–Ω–∏–µ —Ü–≤–µ—Ç–∞ –∂–∞–Ω—Ä–∞', success, 
                        `–¶–≤–µ—Ç –¥–ª—è rock: ${color}`);
                } catch (error) {
                    addResult('–ü–æ–ª—É—á–µ–Ω–∏–µ —Ü–≤–µ—Ç–∞ –∂–∞–Ω—Ä–∞', false, error.message);
                }

                // –¢–µ—Å—Ç 8: –ö–æ–Ω–≤–µ—Ä—Ç–∞—Ü–∏—è –¥–∞–Ω–Ω—ã—Ö –Ø–Ω–¥–µ–∫—Å.–ú—É–∑—ã–∫–∏
                try {
                    const convertedTracks = processor.convertYandexTrackData(yandexTestTracks);
                    const success = convertedTracks.length === 2; // –¢–æ–ª—å–∫–æ –¥–æ—Å—Ç—É–ø–Ω—ã–µ —Ç—Ä–µ–∫–∏
                    addResult('–ö–æ–Ω–≤–µ—Ä—Ç–∞—Ü–∏—è –¥–∞–Ω–Ω—ã—Ö –Ø–Ω–¥–µ–∫—Å.–ú—É–∑—ã–∫–∏', success, 
                        `–ö–æ–Ω–≤–µ—Ä—Ç–∏—Ä–æ–≤–∞–Ω–æ ${convertedTracks.length} –∏–∑ ${yandexTestTracks.length} —Ç—Ä–µ–∫–æ–≤ (–∏—Å–∫–ª—é—á–µ–Ω—ã –Ω–µ–¥–æ—Å—Ç—É–ø–Ω—ã–µ)`);
                } catch (error) {
                    addResult('–ö–æ–Ω–≤–µ—Ä—Ç–∞—Ü–∏—è –¥–∞–Ω–Ω—ã—Ö –Ø–Ω–¥–µ–∫—Å.–ú—É–∑—ã–∫–∏', false, error.message);
                }

                // –¢–µ—Å—Ç 9: –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –æ–±—Ä–∞–±–æ—Ç–∫–∏
                try {
                    const processedTracks = processor.processTrackData(testTracks);
                    const stats = processor.getProcessingStats(processedTracks);
                    const success = stats.totalTracks === testTracks.length;
                    addResult('–°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –æ–±—Ä–∞–±–æ—Ç–∫–∏', success, 
                        `–û–±—â–∞—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –ø–æ–ª—É—á–µ–Ω–∞`);
                    
                    if (success) {
                        // –û—Ç–æ–±—Ä–∞–∂–∞–µ–º –¥–µ—Ç–∞–ª—å–Ω—É—é —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É
                        processingStatsDiv.innerHTML = `
                            <div class="stats-grid">
                                <div class="stat-card">
                                    <div class="stat-value">${stats.totalTracks}</div>
                                    <div class="stat-label">–í—Å–µ–≥–æ —Ç—Ä–µ–∫–æ–≤</div>
                                </div>
                                <div class="stat-card">
                                    <div class="stat-value">${stats.averagePopularity}</div>
                                    <div class="stat-label">–°—Ä–µ–¥–Ω—è—è –ø–æ–ø—É–ª—è—Ä–Ω–æ—Å—Ç—å</div>
                                </div>
                                <div class="stat-card">
                                    <div class="stat-value">${stats.averageSize}</div>
                                    <div class="stat-label">–°—Ä–µ–¥–Ω–∏–π —Ä–∞–∑–º–µ—Ä</div>
                                </div>
                                <div class="stat-card">
                                    <div class="stat-value">${stats.sizeRange.min} - ${stats.sizeRange.max}</div>
                                    <div class="stat-label">–î–∏–∞–ø–∞–∑–æ–Ω —Ä–∞–∑–º–µ—Ä–æ–≤</div>
                                </div>
                            </div>
                            <h4>–†–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –ø–æ –∂–∞–Ω—Ä–∞–º:</h4>
                            <pre>${JSON.stringify(stats.genreDistribution, null, 2)}</pre>
                        `;
                    }
                } catch (error) {
                    addResult('–°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –æ–±—Ä–∞–±–æ—Ç–∫–∏', false, error.message);
                }

                // –ò—Ç–æ–≥–æ–≤—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç
                addInfo(`–¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –∑–∞–≤–µ—Ä—à–µ–Ω–æ: ${testsPassed}/${totalTests} —Ç–µ—Å—Ç–æ–≤ –ø—Ä–æ–π–¥–µ–Ω–æ`);
                
                if (testsPassed === totalTests) {
                    addResult('–í—Å–µ —Ç–µ—Å—Ç—ã –ø—Ä–æ–π–¥–µ–Ω—ã —É—Å–ø–µ—à–Ω–æ! üéâ', true);
                } else {
                    addResult(`–ù–µ–∫–æ—Ç–æ—Ä—ã–µ —Ç–µ—Å—Ç—ã –Ω–µ –ø—Ä–æ–π–¥–µ–Ω—ã (${totalTests - testsPassed} –æ—à–∏–±–æ–∫)`, false);
                }

            } catch (error) {
                addResult('–ö—Ä–∏—Ç–∏—á–µ—Å–∫–∞—è –æ—à–∏–±–∫–∞ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è', false, error.message);
                console.error('–ö—Ä–∏—Ç–∏—á–µ—Å–∫–∞—è –æ—à–∏–±–∫–∞:', error);
            }
        }

        // –ó–∞–ø—É—Å–∫–∞–µ–º —Ç–µ—Å—Ç—ã –ø–æ—Å–ª–µ –∑–∞–≥—Ä—É–∑–∫–∏ —Å—Ç—Ä–∞–Ω–∏—Ü—ã
        window.addEventListener('load', runTests);
    </script>
</body>
</html>
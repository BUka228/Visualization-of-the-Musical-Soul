<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–¢–µ—Å—Ç Task 10 - –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è –∞—É–¥–∏–æ-—Å–∏—Å—Ç–µ–º—ã</title>
    <style>
        body {
            margin: 0;
            padding: 0;
            background: #000;
            color: #fff;
            font-family: Arial, sans-serif;
            overflow: hidden;
        }
        
        #container {
            width: 100vw;
            height: 100vh;
            position: relative;
        }
        
        #track-info {
            position: absolute;
            top: 20px;
            left: 20px;
            background: rgba(0, 0, 0, 0.8);
            padding: 15px;
            border-radius: 8px;
            border: 1px solid rgba(255, 255, 255, 0.2);
            min-width: 250px;
            display: none;
            z-index: 100;
        }
        
        #track-title {
            font-size: 16px;
            font-weight: bold;
            margin-bottom: 5px;
            color: #fff;
        }
        
        #track-artist, #track-album {
            font-size: 14px;
            color: #ccc;
            margin-bottom: 3px;
        }
        
        #controls {
            position: absolute;
            top: 20px;
            right: 20px;
            background: rgba(0, 0, 0, 0.8);
            padding: 15px;
            border-radius: 8px;
            border: 1px solid rgba(255, 255, 255, 0.2);
            z-index: 100;
        }
        
        #controls h3 {
            margin: 0 0 10px 0;
            font-size: 14px;
            color: #fff;
        }
        
        #controls p {
            margin: 5px 0;
            font-size: 12px;
            color: #ccc;
        }
        
        #audio-controls {
            position: absolute;
            bottom: 20px;
            left: 20px;
            background: rgba(0, 0, 0, 0.8);
            padding: 15px;
            border-radius: 8px;
            border: 1px solid rgba(255, 255, 255, 0.2);
            z-index: 100;
        }
        
        #audio-controls h3 {
            margin: 0 0 10px 0;
            font-size: 14px;
            color: #fff;
        }
        
        #audio-controls button {
            background: rgba(255, 255, 255, 0.1);
            border: 1px solid rgba(255, 255, 255, 0.3);
            color: #fff;
            padding: 8px 12px;
            margin: 5px;
            border-radius: 4px;
            cursor: pointer;
            font-size: 12px;
        }
        
        #audio-controls button:hover {
            background: rgba(255, 255, 255, 0.2);
        }
        
        #volume-control {
            margin: 10px 0;
        }
        
        #volume-control input {
            width: 100px;
            margin-left: 10px;
        }
        
        #status {
            position: absolute;
            bottom: 20px;
            right: 20px;
            background: rgba(0, 0, 0, 0.8);
            padding: 15px;
            border-radius: 8px;
            border: 1px solid rgba(255, 255, 255, 0.2);
            z-index: 100;
            min-width: 200px;
        }
        
        #status h3 {
            margin: 0 0 10px 0;
            font-size: 14px;
            color: #fff;
        }
        
        #status p {
            margin: 5px 0;
            font-size: 12px;
            color: #ccc;
        }
        
        .error {
            color: #ff6b6b;
        }
        
        .success {
            color: #51cf66;
        }
    </style>
</head>
<body>
    <div id="container"></div>
    
    <div id="track-info">
        <div id="track-title">–ù–∞–∑–≤–∞–Ω–∏–µ —Ç—Ä–µ–∫–∞</div>
        <div id="track-artist">–ò—Å–ø–æ–ª–Ω–∏—Ç–µ–ª—å: </div>
        <div id="track-album">–ê–ª—å–±–æ–º: </div>
    </div>
    
    <div id="controls">
        <h3>–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ</h3>
        <p><strong>–ú—ã—à—å:</strong> –í—Ä–∞—â–µ–Ω–∏–µ –∫–∞–º–µ—Ä—ã</p>
        <p><strong>–ö–æ–ª–µ—Å–æ:</strong> –ó—É–º</p>
        <p><strong>–ü–ö–ú:</strong> –ü–∞–Ω–æ—Ä–∞–º–∏—Ä–æ–≤–∞–Ω–∏–µ</p>
        <p><strong>–ö–ª–∏–∫:</strong> –í—ã–±–æ—Ä —Ç—Ä–µ–∫–∞</p>
        <p><strong>R:</strong> –°–±—Ä–æ—Å –∫–∞–º–µ—Ä—ã</p>
        <p><strong>–ü—Ä–æ–±–µ–ª:</strong> –ü–∞—É–∑–∞ –∞–Ω–∏–º–∞—Ü–∏–∏</p>
    </div>
    
    <div id="audio-controls">
        <h3>–ê—É–¥–∏–æ —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ</h3>
        <button id="test-audio-btn">–¢–µ—Å—Ç –∞—É–¥–∏–æ</button>
        <button id="stop-audio-btn">–û—Å—Ç–∞–Ω–æ–≤–∏—Ç—å</button>
        <div id="volume-control">
            <label>–ì—Ä–æ–º–∫–æ—Å—Ç—å: <input type="range" id="volume-slider" min="0" max="100" value="50"></label>
        </div>
    </div>
    
    <div id="status">
        <h3>–°—Ç–∞—Ç—É—Å –∞—É–¥–∏–æ</h3>
        <p id="audio-status">–ì–æ—Ç–æ–≤ –∫ –≤–æ—Å–ø—Ä–æ–∏–∑–≤–µ–¥–µ–Ω–∏—é</p>
        <p id="current-track">–¢—Ä–µ–∫: –ù–µ –≤—ã–±—Ä–∞–Ω</p>
        <p id="audio-time">–í—Ä–µ–º—è: 0:00 / 0:00</p>
    </div>

    <script type="module">
        import { SceneManager, DataProcessor } from './dist/bundle.js';

        // –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è —Å—Ü–µ–Ω—ã
        const sceneConfig = {
            galaxyRadius: 50,
            objectMinSize: 0.5,
            objectMaxSize: 3.0,
            animationSpeed: 0.001,
            cameraDistance: 80,
            genreColors: {
                'metal': '#FF0000',
                'rock': '#FF4500', 
                'indie': '#4169E1',
                'pop': '#FFD700',
                'electronic': '#9400D3',
                'jazz': '#228B22',
                'classical': '#F5F5DC',
                'hip-hop': '#8B4513',
                'default': '#FFFFFF'
            }
        };

        // –¢–µ—Å—Ç–æ–≤—ã–µ –¥–∞–Ω–Ω—ã–µ —Å –ø—Ä–µ–≤—å—é URL
        const testTracks = [
            {
                id: '1',
                name: 'Test Track 1',
                artist: 'Test Artist 1',
                album: 'Test Album 1',
                genre: 'indie',
                duration: 180,
                popularity: 85,
                previewUrl: 'https://www.soundjay.com/misc/sounds/bell-ringing-05.wav'
            },
            {
                id: '2',
                name: 'Test Track 2',
                artist: 'Test Artist 2',
                album: 'Test Album 2',
                genre: 'rock',
                duration: 210,
                popularity: 70,
                previewUrl: 'https://www.soundjay.com/misc/sounds/bell-ringing-04.wav'
            },
            {
                id: '3',
                name: 'Test Track 3 (No Preview)',
                artist: 'Test Artist 3',
                album: 'Test Album 3',
                genre: 'metal',
                duration: 195,
                popularity: 90,
                // –ù–µ—Ç previewUrl –¥–ª—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è –æ–±—Ä–∞–±–æ—Ç–∫–∏ –æ—à–∏–±–æ–∫
            },
            {
                id: '4',
                name: 'Test Track 4 (Invalid URL)',
                artist: 'Test Artist 4',
                album: 'Test Album 4',
                genre: 'pop',
                duration: 165,
                popularity: 60,
                previewUrl: 'https://invalid-url-for-testing.com/nonexistent.mp3'
            }
        ];

        let sceneManager;
        let audioManager;

        async function initializeApp() {
            try {
                console.log('üöÄ –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è...');
                
                // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è SceneManager
                const container = document.getElementById('container');
                sceneManager = new SceneManager(container, sceneConfig);
                sceneManager.initializeScene();
                
                // –ü–æ–ª—É—á–∞–µ–º AudioManager –∏–∑ InteractionManager
                const interactionManager = sceneManager.getInteractionManager();
                audioManager = interactionManager.getAudioManager();
                
                console.log('‚úÖ SceneManager –∏ AudioManager –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω—ã');
                
                // –û–±—Ä–∞–±–æ—Ç–∫–∞ –¥–∞–Ω–Ω—ã—Ö —Ç—Ä–µ–∫–æ–≤
                const dataProcessor = new DataProcessor(sceneConfig);
                const processedTracks = dataProcessor.processTrackData(testTracks);
                
                console.log('‚úÖ –î–∞–Ω–Ω—ã–µ —Ç—Ä–µ–∫–æ–≤ –æ–±—Ä–∞–±–æ—Ç–∞–Ω—ã:', processedTracks.length);
                
                // –°–æ–∑–¥–∞–Ω–∏–µ –æ–±—ä–µ–∫—Ç–æ–≤ —Ç—Ä–µ–∫–æ–≤ –≤ —Å—Ü–µ–Ω–µ
                sceneManager.createTrackObjects(processedTracks);
                
                console.log('‚úÖ –û–±—ä–µ–∫—Ç—ã —Ç—Ä–µ–∫–æ–≤ —Å–æ–∑–¥–∞–Ω—ã –≤ —Å—Ü–µ–Ω–µ');
                
                // –ù–∞—Å—Ç—Ä–æ–π–∫–∞ UI –∫–æ–Ω—Ç—Ä–æ–ª–æ–≤
                setupAudioControls();
                
                // –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞ –∞—É–¥–∏–æ —Å—Ç–∞—Ç—É—Å–∞
                setupAudioStatusMonitoring();
                
                updateStatus('–ü—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –≥–æ—Ç–æ–≤–æ –∫ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—é', 'success');
                
            } catch (error) {
                console.error('‚ùå –û—à–∏–±–∫–∞ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏:', error);
                updateStatus(`–û—à–∏–±–∫–∞ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏: ${error.message}`, 'error');
            }
        }

        function setupAudioControls() {
            const testAudioBtn = document.getElementById('test-audio-btn');
            const stopAudioBtn = document.getElementById('stop-audio-btn');
            const volumeSlider = document.getElementById('volume-slider');

            // –¢–µ—Å—Ç –∞—É–¥–∏–æ —Å –¥–µ–º–æ URL
            testAudioBtn.addEventListener('click', async () => {
                try {
                    updateStatus('–¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –∞—É–¥–∏–æ...', '');
                    const testUrl = 'https://www.soundjay.com/misc/sounds/bell-ringing-05.wav';
                    await audioManager.playPreview(testUrl);
                    updateStatus('–¢–µ—Å—Ç –∞—É–¥–∏–æ –∑–∞–ø—É—â–µ–Ω', 'success');
                } catch (error) {
                    console.error('–û—à–∏–±–∫–∞ —Ç–µ—Å—Ç –∞—É–¥–∏–æ:', error);
                    updateStatus(`–û—à–∏–±–∫–∞ —Ç–µ—Å—Ç –∞—É–¥–∏–æ: ${error.message}`, 'error');
                }
            });

            // –û—Å—Ç–∞–Ω–æ–≤–∫–∞ –∞—É–¥–∏–æ
            stopAudioBtn.addEventListener('click', () => {
                audioManager.stopPreview();
                updateStatus('–ê—É–¥–∏–æ –æ—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–æ', '');
            });

            // –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –≥—Ä–æ–º–∫–æ—Å—Ç—å—é
            volumeSlider.addEventListener('input', (e) => {
                const volume = e.target.value / 100;
                audioManager.setVolume(volume);
                console.log(`–ì—Ä–æ–º–∫–æ—Å—Ç—å —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∞: ${Math.round(volume * 100)}%`);
            });
        }

        function setupAudioStatusMonitoring() {
            // –û–±–Ω–æ–≤–ª—è–µ–º —Å—Ç–∞—Ç—É—Å –∞—É–¥–∏–æ –∫–∞–∂–¥—ã–µ 500ms
            setInterval(() => {
                updateAudioStatus();
            }, 500);
        }

        function updateAudioStatus() {
            const audioStatusEl = document.getElementById('audio-status');
            const currentTrackEl = document.getElementById('current-track');
            const audioTimeEl = document.getElementById('audio-time');

            if (audioManager.isPlaying()) {
                audioStatusEl.textContent = '–í–æ—Å–ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç—Å—è';
                audioStatusEl.className = 'success';
                
                const currentTime = audioManager.getCurrentTime();
                const duration = audioManager.getDuration ? audioManager.getDuration() : 0;
                
                const formatTime = (seconds) => {
                    const mins = Math.floor(seconds / 60);
                    const secs = Math.floor(seconds % 60);
                    return `${mins}:${secs.toString().padStart(2, '0')}`;
                };
                
                audioTimeEl.textContent = `–í—Ä–µ–º—è: ${formatTime(currentTime)} / ${formatTime(duration)}`;
            } else {
                audioStatusEl.textContent = '–û—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–æ';
                audioStatusEl.className = '';
                audioTimeEl.textContent = '–í—Ä–µ–º—è: 0:00 / 0:00';
            }

            // –û–±–Ω–æ–≤–ª—è–µ–º –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ —Ç–µ–∫—É—â–µ–º —Ç—Ä–µ–∫–µ
            const interactionManager = sceneManager?.getInteractionManager();
            const selectedTrack = interactionManager?.getSelectedTrack?.();
            
            if (selectedTrack && selectedTrack.trackData) {
                currentTrackEl.textContent = `–¢—Ä–µ–∫: ${selectedTrack.trackData.name}`;
            } else {
                currentTrackEl.textContent = '–¢—Ä–µ–∫: –ù–µ –≤—ã–±—Ä–∞–Ω';
            }
        }

        function updateStatus(message, type = '') {
            const statusEl = document.getElementById('audio-status');
            statusEl.textContent = message;
            statusEl.className = type;
            console.log(`Status: ${message}`);
        }

        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ —Å—Ç—Ä–∞–Ω–∏—Ü—ã
        window.addEventListener('load', initializeApp);

        // –û—á–∏—Å—Ç–∫–∞ —Ä–µ—Å—É—Ä—Å–æ–≤ –ø—Ä–∏ –∑–∞–∫—Ä—ã—Ç–∏–∏ —Å—Ç—Ä–∞–Ω–∏—Ü—ã
        window.addEventListener('beforeunload', () => {
            if (sceneManager) {
                sceneManager.dispose();
            }
        });

        // –û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫
        window.addEventListener('error', (event) => {
            console.error('–ì–ª–æ–±–∞–ª—å–Ω–∞—è –æ—à–∏–±–∫–∞:', event.error);
            updateStatus(`–û—à–∏–±–∫–∞: ${event.error.message}`, 'error');
        });

        // –≠–∫—Å–ø–æ—Ä—Ç –¥–ª—è –æ—Ç–ª–∞–¥–∫–∏
        window.sceneManager = sceneManager;
        window.audioManager = audioManager;
    </script>
    
    <!-- –°–∫—Ä–∏–ø—Ç –ø—Ä–æ–≤–µ—Ä–∫–∏ –∞—É–¥–∏–æ-—Å–∏—Å—Ç–µ–º—ã -->
    <script src="verify-task10-audio.js"></script>
</body>
</html>
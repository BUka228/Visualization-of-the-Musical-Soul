<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–¢–µ—Å—Ç TrackObject - –ó–∞–¥–∞—á–∞ 7</title>
    <style>
        body {
            margin: 0;
            padding: 0;
            background: #000;
            color: #fff;
            font-family: Arial, sans-serif;
            overflow: hidden;
        }
        
        #container {
            width: 100vw;
            height: 100vh;
            position: relative;
        }
        
        #info {
            position: absolute;
            top: 10px;
            left: 10px;
            z-index: 100;
            background: rgba(0, 0, 0, 0.7);
            padding: 15px;
            border-radius: 5px;
            max-width: 300px;
        }
        
        #controls {
            position: absolute;
            top: 10px;
            right: 10px;
            z-index: 100;
            background: rgba(0, 0, 0, 0.7);
            padding: 15px;
            border-radius: 5px;
        }
        
        button {
            background: #4169E1;
            color: white;
            border: none;
            padding: 8px 16px;
            margin: 5px;
            border-radius: 3px;
            cursor: pointer;
        }
        
        button:hover {
            background: #5179F1;
        }
        
        .genre-info {
            margin: 5px 0;
            padding: 5px;
            border-left: 3px solid;
            background: rgba(255, 255, 255, 0.1);
        }
        
        .stats {
            margin-top: 10px;
            font-size: 12px;
            color: #ccc;
        }
    </style>
</head>
<body>
    <div id="container"></div>
    
    <div id="info">
        <h3>üéµ –¢–µ—Å—Ç TrackObject - –ó–∞–¥–∞—á–∞ 7</h3>
        <p>–¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ —Å–æ–∑–¥–∞–Ω–∏—è –∏ —Ä–∞–∑–º–µ—â–µ–Ω–∏—è 3D-–æ–±—ä–µ–∫—Ç–æ–≤ —Ç—Ä–µ–∫–æ–≤</p>
        <div id="stats">
            <div>–û–±—ä–µ–∫—Ç–æ–≤ —Å–æ–∑–¥–∞–Ω–æ: <span id="objectCount">0</span></div>
            <div>–ñ–∞–Ω—Ä–æ–≤: <span id="genreCount">0</span></div>
        </div>
        <div id="genreList"></div>
    </div>
    
    <div id="controls">
        <button onclick="createTestTracks()">–°–æ–∑–¥–∞—Ç—å —Ç–µ—Å—Ç–æ–≤—ã–µ —Ç—Ä–µ–∫–∏</button>
        <button onclick="toggleAnimation()">–ü–∞—É–∑–∞/–í–æ—Å–ø—Ä–æ–∏–∑–≤–µ–¥–µ–Ω–∏–µ</button>
        <button onclick="resetCamera()">–°–±—Ä–æ—Å –∫–∞–º–µ—Ä—ã</button>
        <button onclick="showGenreStats()">–°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –∂–∞–Ω—Ä–æ–≤</button>
    </div>

    <script type="module">
        import { SceneManager } from './src/scene/SceneManager.js';
        import { DataProcessor } from './src/data/DataProcessor.js';
        
        // –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è —Å—Ü–µ–Ω—ã
        const sceneConfig = {
            galaxyRadius: 50,
            objectMinSize: 0.5,
            objectMaxSize: 3.0,
            animationSpeed: 0.005,
            cameraDistance: 80,
            genreColors: {
                'metal': '#FF0000',
                'rock': '#FF4500',
                'indie': '#4169E1',
                'pop': '#FFD700',
                'electronic': '#9400D3',
                'jazz': '#228B22',
                'classical': '#F5F5DC',
                'hip-hop': '#8B4513',
                'default': '#FFFFFF'
            }
        };
        
        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –º–µ–Ω–µ–¥–∂–µ—Ä–∞ —Å—Ü–µ–Ω—ã
        const container = document.getElementById('container');
        const sceneManager = new SceneManager(container, sceneConfig);
        const dataProcessor = new DataProcessor();
        
        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è —Å—Ü–µ–Ω—ã
        sceneManager.initializeScene();
        
        // –¢–µ—Å—Ç–æ–≤—ã–µ –¥–∞–Ω–Ω—ã–µ —Ç—Ä–µ–∫–æ–≤
        const testTracks = [
            {
                id: '1',
                name: 'Master of Puppets',
                artist: 'Metallica',
                album: 'Master of Puppets',
                genre: 'metal',
                duration: 515,
                popularity: 95,
                previewUrl: undefined,
                imageUrl: undefined,
                playCount: 1000000
            },
            {
                id: '2',
                name: 'Bohemian Rhapsody',
                artist: 'Queen',
                album: 'A Night at the Opera',
                genre: 'rock',
                duration: 355,
                popularity: 98,
                previewUrl: undefined,
                imageUrl: undefined,
                playCount: 2000000
            },
            {
                id: '3',
                name: 'Radioactive',
                artist: 'Imagine Dragons',
                album: 'Night Visions',
                genre: 'indie',
                duration: 187,
                popularity: 90,
                previewUrl: undefined,
                imageUrl: undefined,
                playCount: 1500000
            },
            {
                id: '4',
                name: 'Shape of You',
                artist: 'Ed Sheeran',
                album: '√∑',
                genre: 'pop',
                duration: 233,
                popularity: 92,
                previewUrl: undefined,
                imageUrl: undefined,
                playCount: 3000000
            },
            {
                id: '5',
                name: 'Strobe',
                artist: 'Deadmau5',
                album: 'For Lack of a Better Name',
                genre: 'electronic',
                duration: 645,
                popularity: 85,
                previewUrl: undefined,
                imageUrl: undefined,
                playCount: 800000
            },
            {
                id: '6',
                name: 'Take Five',
                artist: 'Dave Brubeck',
                album: 'Time Out',
                genre: 'jazz',
                duration: 324,
                popularity: 75,
                previewUrl: undefined,
                imageUrl: undefined,
                playCount: 500000
            },
            {
                id: '7',
                name: 'Symphony No. 9',
                artist: 'Beethoven',
                album: 'Classical Collection',
                genre: 'classical',
                duration: 4200,
                popularity: 80,
                previewUrl: undefined,
                imageUrl: undefined,
                playCount: 600000
            },
            {
                id: '8',
                name: 'Lose Yourself',
                artist: 'Eminem',
                album: '8 Mile Soundtrack',
                genre: 'hip-hop',
                duration: 326,
                popularity: 94,
                previewUrl: undefined,
                imageUrl: undefined,
                playCount: 1800000
            },
            {
                id: '9',
                name: 'Stairway to Heaven',
                artist: 'Led Zeppelin',
                album: 'Led Zeppelin IV',
                genre: 'rock',
                duration: 482,
                popularity: 96,
                previewUrl: undefined,
                imageUrl: undefined,
                playCount: 2500000
            },
            {
                id: '10',
                name: 'Billie Jean',
                artist: 'Michael Jackson',
                album: 'Thriller',
                genre: 'pop',
                duration: 294,
                popularity: 97,
                previewUrl: undefined,
                imageUrl: undefined,
                playCount: 2200000
            }
        ];
        
        // –ì–ª–æ–±–∞–ª—å–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏ –¥–ª—è –∫–Ω–æ–ø–æ–∫
        window.createTestTracks = function() {
            console.log('üéµ –°–æ–∑–¥–∞–Ω–∏–µ —Ç–µ—Å—Ç–æ–≤—ã—Ö —Ç—Ä–µ–∫–æ–≤...');
            
            // –û–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ–º —Ç–µ—Å—Ç–æ–≤—ã–µ —Ç—Ä–µ–∫–∏
            const processedTracks = dataProcessor.processTrackData(testTracks);
            
            // –°–æ–∑–¥–∞–µ–º –æ–±—ä–µ–∫—Ç—ã –≤ —Å—Ü–µ–Ω–µ
            sceneManager.createTrackObjects(processedTracks);
            
            // –û–±–Ω–æ–≤–ª—è–µ–º —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É
            updateStats(processedTracks);
            
            console.log('‚úÖ –¢–µ—Å—Ç–æ–≤—ã–µ —Ç—Ä–µ–∫–∏ —Å–æ–∑–¥–∞–Ω—ã');
        };
        
        window.toggleAnimation = function() {
            const interactionManager = sceneManager.getInteractionManager();
            interactionManager.toggleAnimation();
        };
        
        window.resetCamera = function() {
            const interactionManager = sceneManager.getInteractionManager();
            interactionManager.resetCamera();
        };
        
        window.showGenreStats = function() {
            const trackObjects = sceneManager.getTrackObjects();
            const genreStats = {};
            
            trackObjects.forEach(obj => {
                const genre = obj.trackData.genre;
                if (!genreStats[genre]) {
                    genreStats[genre] = {
                        count: 0,
                        totalSize: 0,
                        avgPopularity: 0,
                        color: obj.trackData.color
                    };
                }
                genreStats[genre].count++;
                genreStats[genre].totalSize += obj.trackData.size;
                genreStats[genre].avgPopularity += obj.trackData.popularity;
            });
            
            console.log('üìä –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –ø–æ –∂–∞–Ω—Ä–∞–º:');
            Object.entries(genreStats).forEach(([genre, stats]) => {
                stats.avgSize = (stats.totalSize / stats.count).toFixed(2);
                stats.avgPopularity = Math.round(stats.avgPopularity / stats.count);
                console.log(`${genre}: ${stats.count} —Ç—Ä–µ–∫–æ–≤, —Å—Ä–µ–¥–Ω–∏–π —Ä–∞–∑–º–µ—Ä: ${stats.avgSize}, —Å—Ä–µ–¥–Ω—è—è –ø–æ–ø—É–ª—è—Ä–Ω–æ—Å—Ç—å: ${stats.avgPopularity}`);
            });
        };
        
        function updateStats(processedTracks) {
            document.getElementById('objectCount').textContent = processedTracks.length;
            
            const genres = [...new Set(processedTracks.map(t => t.genre))];
            document.getElementById('genreCount').textContent = genres.length;
            
            const genreList = document.getElementById('genreList');
            genreList.innerHTML = '';
            
            genres.forEach(genre => {
                const genreTracks = processedTracks.filter(t => t.genre === genre);
                const avgSize = (genreTracks.reduce((sum, t) => sum + t.size, 0) / genreTracks.length).toFixed(2);
                const color = genreTracks[0].color;
                
                const div = document.createElement('div');
                div.className = 'genre-info';
                div.style.borderLeftColor = color;
                div.innerHTML = `
                    <strong>${genre}</strong>: ${genreTracks.length} —Ç—Ä–µ–∫–æ–≤<br>
                    <small>–°—Ä–µ–¥–Ω–∏–π —Ä–∞–∑–º–µ—Ä: ${avgSize}</small>
                `;
                genreList.appendChild(div);
            });
        }
        
        // –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —Å–æ–∑–¥–∞–µ–º —Ç–µ—Å—Ç–æ–≤—ã–µ —Ç—Ä–µ–∫–∏ –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ
        setTimeout(() => {
            createTestTracks();
        }, 1000);
        
        console.log('üöÄ –¢–µ—Å—Ç TrackObject –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω');
        console.log('–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ:');
        console.log('- –õ–µ–≤–∞—è –∫–Ω–æ–ø–∫–∞ –º—ã—à–∏: –≤—Ä–∞—â–µ–Ω–∏–µ –∫–∞–º–µ—Ä—ã');
        console.log('- –ö–æ–ª–µ—Å–æ –º—ã—à–∏: –∑—É–º');
        console.log('- –ü—Ä–∞–≤–∞—è –∫–Ω–æ–ø–∫–∞ –º—ã—à–∏: –ø–∞–Ω–æ—Ä–∞–º–∏—Ä–æ–≤–∞–Ω–∏–µ');
        console.log('- R: —Å–±—Ä–æ—Å –∫–∞–º–µ—Ä—ã');
        console.log('- –ü—Ä–æ–±–µ–ª: –ø–∞—É–∑–∞ –∞–Ω–∏–º–∞—Ü–∏–∏');
    </script>
</body>
</html>
<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–ü—Ä–æ—Å—Ç–æ–π —Ç–µ—Å—Ç Task 10 - AudioManager</title>
    <style>
        body {
            margin: 0;
            padding: 20px;
            background: #000;
            color: #fff;
            font-family: Arial, sans-serif;
        }
        
        .container {
            max-width: 800px;
            margin: 0 auto;
        }
        
        .test-section {
            background: rgba(255, 255, 255, 0.1);
            padding: 20px;
            margin: 20px 0;
            border-radius: 8px;
            border: 1px solid rgba(255, 255, 255, 0.2);
        }
        
        .test-section h2 {
            margin-top: 0;
            color: #4169E1;
        }
        
        button {
            background: rgba(255, 255, 255, 0.1);
            border: 1px solid rgba(255, 255, 255, 0.3);
            color: #fff;
            padding: 10px 15px;
            margin: 5px;
            border-radius: 4px;
            cursor: pointer;
            font-size: 14px;
        }
        
        button:hover {
            background: rgba(255, 255, 255, 0.2);
        }
        
        .status {
            margin: 10px 0;
            padding: 10px;
            border-radius: 4px;
            font-size: 14px;
        }
        
        .success {
            background: rgba(0, 255, 0, 0.2);
            border: 1px solid rgba(0, 255, 0, 0.4);
            color: #00ff00;
        }
        
        .error {
            background: rgba(255, 0, 0, 0.2);
            border: 1px solid rgba(255, 0, 0, 0.4);
            color: #ff6b6b;
        }
        
        .info {
            background: rgba(0, 0, 255, 0.2);
            border: 1px solid rgba(0, 0, 255, 0.4);
            color: #6bb6ff;
        }
        
        #log {
            background: #111;
            padding: 15px;
            border-radius: 4px;
            font-family: monospace;
            font-size: 12px;
            max-height: 300px;
            overflow-y: auto;
            white-space: pre-wrap;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>üéµ –¢–µ—Å—Ç AudioManager - Task 10</h1>
        
        <div class="test-section">
            <h2>1. –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è AudioManager</h2>
            <button id="init-test">–¢–µ—Å—Ç –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏</button>
            <div id="init-status" class="status info">–ì–æ—Ç–æ–≤ –∫ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—é</div>
        </div>
        
        <div class="test-section">
            <h2>2. –¢–µ—Å—Ç –≤–æ—Å–ø—Ä–æ–∏–∑–≤–µ–¥–µ–Ω–∏—è</h2>
            <button id="play-test">–í–æ—Å–ø—Ä–æ–∏–∑–≤–µ—Å—Ç–∏ —Ç–µ—Å—Ç–æ–≤—ã–π –∑–≤—É–∫</button>
            <button id="stop-test">–û—Å—Ç–∞–Ω–æ–≤–∏—Ç—å</button>
            <div id="play-status" class="status info">–ì–æ—Ç–æ–≤ –∫ –≤–æ—Å–ø—Ä–æ–∏–∑–≤–µ–¥–µ–Ω–∏—é</div>
        </div>
        
        <div class="test-section">
            <h2>3. –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –≥—Ä–æ–º–∫–æ—Å—Ç—å—é</h2>
            <button id="volume-low">–¢–∏—Ö–æ (25%)</button>
            <button id="volume-medium">–°—Ä–µ–¥–Ω–µ (50%)</button>
            <button id="volume-high">–ì—Ä–æ–º–∫–æ (75%)</button>
            <div id="volume-status" class="status info">–ì—Ä–æ–º–∫–æ—Å—Ç—å: 50%</div>
        </div>
        
        <div class="test-section">
            <h2>4. –û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫</h2>
            <button id="error-test">–¢–µ—Å—Ç —Å –Ω–µ–≤–µ—Ä–Ω—ã–º URL</button>
            <div id="error-status" class="status info">–ì–æ—Ç–æ–≤ –∫ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—é –æ—à–∏–±–æ–∫</div>
        </div>
        
        <div class="test-section">
            <h2>5. –õ–æ–≥ —Å–æ–±—ã—Ç–∏–π</h2>
            <button id="clear-log">–û—á–∏—Å—Ç–∏—Ç—å –ª–æ–≥</button>
            <div id="log"></div>
        </div>
    </div>

    <script type="module">
        import { AudioManager } from './dist/bundle.js';

        let audioManager;
        const logElement = document.getElementById('log');

        function log(message, type = 'info') {
            const timestamp = new Date().toLocaleTimeString();
            const logMessage = `[${timestamp}] ${message}\n`;
            logElement.textContent += logMessage;
            logElement.scrollTop = logElement.scrollHeight;
            
            console.log(message);
        }

        function updateStatus(elementId, message, type = 'info') {
            const element = document.getElementById(elementId);
            element.textContent = message;
            element.className = `status ${type}`;
        }

        // 1. –¢–µ—Å—Ç –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏
        document.getElementById('init-test').addEventListener('click', () => {
            try {
                audioManager = new AudioManager();
                log('‚úÖ AudioManager —É—Å–ø–µ—à–Ω–æ —Å–æ–∑–¥–∞–Ω');
                updateStatus('init-status', 'AudioManager –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω', 'success');
                
                // –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –∫–æ–ª–ª–±—ç–∫–æ–≤
                audioManager.setOnPlayStart(() => {
                    log('üéµ –ö–æ–ª–ª–±—ç–∫: –í–æ—Å–ø—Ä–æ–∏–∑–≤–µ–¥–µ–Ω–∏–µ –Ω–∞—á–∞–ª–æ—Å—å');
                });
                
                audioManager.setOnPlayEnd(() => {
                    log('üéµ –ö–æ–ª–ª–±—ç–∫: –í–æ—Å–ø—Ä–æ–∏–∑–≤–µ–¥–µ–Ω–∏–µ –∑–∞–≤–µ—Ä—à–µ–Ω–æ');
                });
                
                audioManager.setOnError((error) => {
                    log(`‚ùå –ö–æ–ª–ª–±—ç–∫ –æ—à–∏–±–∫–∏: ${error.message}`);
                });
                
                log('‚úÖ –ö–æ–ª–ª–±—ç–∫–∏ –Ω–∞—Å—Ç—Ä–æ–µ–Ω—ã');
                
            } catch (error) {
                log(`‚ùå –û—à–∏–±–∫–∞ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏: ${error.message}`);
                updateStatus('init-status', `–û—à–∏–±–∫–∞: ${error.message}`, 'error');
            }
        });

        // 2. –¢–µ—Å—Ç –≤–æ—Å–ø—Ä–æ–∏–∑–≤–µ–¥–µ–Ω–∏—è
        document.getElementById('play-test').addEventListener('click', async () => {
            if (!audioManager) {
                updateStatus('play-status', '–°–Ω–∞—á–∞–ª–∞ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä—É–π—Ç–µ AudioManager', 'error');
                return;
            }

            try {
                updateStatus('play-status', '–ó–∞–≥—Ä—É–∑–∫–∞ –∞—É–¥–∏–æ...', 'info');
                log('üéµ –ù–∞—á–∏–Ω–∞–µ–º –≤–æ—Å–ø—Ä–æ–∏–∑–≤–µ–¥–µ–Ω–∏–µ —Ç–µ—Å—Ç–æ–≤–æ–≥–æ –∑–≤—É–∫–∞...');
                
                // –ò—Å–ø–æ–ª—å–∑—É–µ–º –ø—Ä–æ—Å—Ç–æ–π —Ç–µ—Å—Ç–æ–≤—ã–π –∑–≤—É–∫
                const testUrl = 'data:audio/wav;base64,UklGRnoGAABXQVZFZm10IBAAAAABAAEAQB8AAEAfAAABAAgAZGF0YQoGAACBhYqFbF1fdJivrJBhNjVgodDbq2EcBj+a2/LDciUFLIHO8tiJNwgZaLvt559NEAxQp+PwtmMcBjiR1/LMeSwFJHfH8N2QQAoUXrTp66hVFApGn+DyvmwhBSuBzvLZiTYIG2m98OScTgwOUarm7blmGgU7k9n1unEiBC13yO/eizEIHWq+8+OWT';
                
                await audioManager.playPreview(testUrl);
                
                updateStatus('play-status', '–í–æ—Å–ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç—Å—è —Ç–µ—Å—Ç–æ–≤—ã–π –∑–≤—É–∫', 'success');
                log('‚úÖ –¢–µ—Å—Ç–æ–≤—ã–π –∑–≤—É–∫ –≤–æ—Å–ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç—Å—è');
                
            } catch (error) {
                log(`‚ùå –û—à–∏–±–∫–∞ –≤–æ—Å–ø—Ä–æ–∏–∑–≤–µ–¥–µ–Ω–∏—è: ${error.message}`);
                updateStatus('play-status', `–û—à–∏–±–∫–∞: ${error.message}`, 'error');
            }
        });

        document.getElementById('stop-test').addEventListener('click', () => {
            if (!audioManager) {
                updateStatus('play-status', 'AudioManager –Ω–µ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω', 'error');
                return;
            }

            audioManager.stopPreview();
            updateStatus('play-status', '–í–æ—Å–ø—Ä–æ–∏–∑–≤–µ–¥–µ–Ω–∏–µ –æ—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–æ', 'info');
            log('‚èπÔ∏è –í–æ—Å–ø—Ä–æ–∏–∑–≤–µ–¥–µ–Ω–∏–µ –æ—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–æ');
        });

        // 3. –¢–µ—Å—Ç—ã –≥—Ä–æ–º–∫–æ—Å—Ç–∏
        document.getElementById('volume-low').addEventListener('click', () => {
            if (!audioManager) return;
            audioManager.setVolume(0.25);
            updateStatus('volume-status', '–ì—Ä–æ–º–∫–æ—Å—Ç—å: 25%', 'success');
            log('üîä –ì—Ä–æ–º–∫–æ—Å—Ç—å —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∞: 25%');
        });

        document.getElementById('volume-medium').addEventListener('click', () => {
            if (!audioManager) return;
            audioManager.setVolume(0.5);
            updateStatus('volume-status', '–ì—Ä–æ–º–∫–æ—Å—Ç—å: 50%', 'success');
            log('üîä –ì—Ä–æ–º–∫–æ—Å—Ç—å —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∞: 50%');
        });

        document.getElementById('volume-high').addEventListener('click', () => {
            if (!audioManager) return;
            audioManager.setVolume(0.75);
            updateStatus('volume-status', '–ì—Ä–æ–º–∫–æ—Å—Ç—å: 75%', 'success');
            log('üîä –ì—Ä–æ–º–∫–æ—Å—Ç—å —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∞: 75%');
        });

        // 4. –¢–µ—Å—Ç –æ—à–∏–±–æ–∫
        document.getElementById('error-test').addEventListener('click', async () => {
            if (!audioManager) {
                updateStatus('error-status', 'AudioManager –Ω–µ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω', 'error');
                return;
            }

            try {
                updateStatus('error-status', '–¢–µ—Å—Ç–∏—Ä—É–µ–º –æ–±—Ä–∞–±–æ—Ç–∫—É –æ—à–∏–±–æ–∫...', 'info');
                log('‚ö†Ô∏è –¢–µ—Å—Ç–∏—Ä—É–µ–º –≤–æ—Å–ø—Ä–æ–∏–∑–≤–µ–¥–µ–Ω–∏–µ –Ω–µ–≤–µ—Ä–Ω–æ–≥–æ URL...');
                
                const invalidUrl = 'https://invalid-url-for-testing.com/nonexistent.mp3';
                await audioManager.playPreview(invalidUrl);
                
                // –ï—Å–ª–∏ –º—ã –¥–æ—à–ª–∏ —Å—é–¥–∞, —Ç–æ –æ—à–∏–±–∫–∏ –Ω–µ –±—ã–ª–æ (–Ω–µ–æ–∂–∏–¥–∞–Ω–Ω–æ)
                updateStatus('error-status', '–ù–µ–æ–∂–∏–¥–∞–Ω–Ω–æ: –æ—à–∏–±–∫–∏ –Ω–µ –ø—Ä–æ–∏–∑–æ—à–ª–æ', 'info');
                log('‚ö†Ô∏è –ù–µ–æ–∂–∏–¥–∞–Ω–Ω–æ: –≤–æ—Å–ø—Ä–æ–∏–∑–≤–µ–¥–µ–Ω–∏–µ –ø—Ä–æ—à–ª–æ –±–µ–∑ –æ—à–∏–±–æ–∫');
                
            } catch (error) {
                updateStatus('error-status', '–û—à–∏–±–∫–∞ –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ –æ–±—Ä–∞–±–æ—Ç–∞–Ω–∞', 'success');
                log(`‚úÖ –û—à–∏–±–∫–∞ –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ –æ–±—Ä–∞–±–æ—Ç–∞–Ω–∞: ${error.message}`);
            }
        });

        // 5. –û—á–∏—Å—Ç–∫–∞ –ª–æ–≥–∞
        document.getElementById('clear-log').addEventListener('click', () => {
            logElement.textContent = '';
            log('üßπ –õ–æ–≥ –æ—á–∏—â–µ–Ω');
        });

        // –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ —Å–æ—Å—Ç–æ—è–Ω–∏—è –∞—É–¥–∏–æ
        setInterval(() => {
            if (audioManager) {
                const isPlaying = audioManager.isPlaying();
                const currentTime = audioManager.getCurrentTime();
                const duration = audioManager.getDuration();
                
                if (isPlaying) {
                    const formatTime = (seconds) => {
                        const mins = Math.floor(seconds / 60);
                        const secs = Math.floor(seconds % 60);
                        return `${mins}:${secs.toString().padStart(2, '0')}`;
                    };
                    
                    const timeInfo = `${formatTime(currentTime)} / ${formatTime(duration)}`;
                    updateStatus('play-status', `–í–æ—Å–ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç—Å—è: ${timeInfo}`, 'success');
                }
            }
        }, 1000);

        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ
        log('üöÄ –°—Ç—Ä–∞–Ω–∏—Ü–∞ –∑–∞–≥—Ä—É–∂–µ–Ω–∞. –ù–∞–∂–º–∏—Ç–µ "–¢–µ—Å—Ç –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏" –¥–ª—è –Ω–∞—á–∞–ª–∞.');
    </script>
</body>
</html>
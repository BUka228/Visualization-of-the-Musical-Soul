<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–ü—Ä–æ–≤–µ—Ä–∫–∞ –∑–∞–¥–∞—á–∏ 6 - DataProcessor</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 20px;
            background: #1a1a1a;
            color: #ffffff;
            line-height: 1.6;
        }
        .container {
            max-width: 800px;
            margin: 0 auto;
        }
        .test-result {
            margin: 10px 0;
            padding: 15px;
            border-radius: 8px;
            border-left: 4px solid;
        }
        .success {
            background: #2d5a2d;
            border-left-color: #4caf50;
        }
        .error {
            background: #5a2d2d;
            border-left-color: #f44336;
        }
        .info {
            background: #2d3a5a;
            border-left-color: #2196f3;
        }
        .code {
            background: #333;
            padding: 10px;
            border-radius: 4px;
            font-family: monospace;
            margin: 10px 0;
        }
        .stats {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 15px;
            margin: 20px 0;
        }
        .stat-card {
            background: #333;
            padding: 15px;
            border-radius: 6px;
            text-align: center;
        }
        .stat-value {
            font-size: 24px;
            font-weight: bold;
            color: #4caf50;
        }
        .stat-label {
            font-size: 14px;
            color: #ccc;
        }
        h1, h2 {
            color: #4fc3f7;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>üß™ –ü—Ä–æ–≤–µ—Ä–∫–∞ –∑–∞–¥–∞—á–∏ 6: –†–∞–∑—Ä–∞–±–æ—Ç–∫–∞ –º–æ–¥—É–ª—è –æ–±—Ä–∞–±–æ—Ç–∫–∏ –¥–∞–Ω–Ω—ã—Ö</h1>
        
        <div class="info test-result">
            <h3>üìã –ü—Ä–æ–≤–µ—Ä—è–µ–º—ã–µ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã:</h3>
            <ul>
                <li>‚úÖ DataProcessor –∫–ª–∞—Å—Å —Å –º–µ—Ç–æ–¥–∞–º–∏ –∞–Ω–∞–ª–∏–∑–∞ –¥–∞–Ω–Ω—ã—Ö –∏–∑ –Ø–Ω–¥–µ–∫—Å.–ú—É–∑—ã–∫–∏</li>
                <li>‚úÖ –§—É–Ω–∫—Ü–∏–∏ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è —Ü–≤–µ—Ç–∞ –ø–æ –∂–∞–Ω—Ä—É –∏ —Ä–∞–∑–º–µ—Ä–∞ –ø–æ –ø–æ–ø—É–ª—è—Ä–Ω–æ—Å—Ç–∏</li>
                <li>‚úÖ –ê–ª–≥–æ—Ä–∏—Ç–º —Å—Ñ–µ—Ä–∏—á–µ—Å–∫–æ–≥–æ —Ä–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è –æ–±—ä–µ–∫—Ç–æ–≤ –≤ 3D-–ø—Ä–æ—Å—Ç—Ä–∞–Ω—Å—Ç–≤–µ</li>
                <li>‚úÖ –ö–æ–Ω–≤–µ—Ä—Ç–∞—Ü–∏—è –¥–∞–Ω–Ω—ã—Ö YandexTrack –≤ ProcessedTrack</li>
            </ul>
        </div>

        <div id="test-results"></div>

        <h2>üìä –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –æ–±—Ä–∞–±–æ—Ç–∫–∏</h2>
        <div id="stats-container"></div>

        <h2>üé® –¶–≤–µ—Ç–∞ –∂–∞–Ω—Ä–æ–≤</h2>
        <div id="genre-colors"></div>

        <h2>üìç –ü—Ä–∏–º–µ—Ä—ã –ø–æ–∑–∏—Ü–∏–π</h2>
        <div id="position-examples"></div>
    </div>

    <script type="module">
        // –ò–º–ø–æ—Ä—Ç–∏—Ä—É–µ–º –Ω–µ–æ–±—Ö–æ–¥–∏–º—ã–µ –º–æ–¥—É–ª–∏
        import { DataProcessor } from './dist/data/DataProcessor.js';
        import { DataLoader } from './dist/data/DataLoader.js';

        const resultsContainer = document.getElementById('test-results');
        const statsContainer = document.getElementById('stats-container');
        const genreColorsContainer = document.getElementById('genre-colors');
        const positionExamplesContainer = document.getElementById('position-examples');

        function addResult(message, success, details = '') {
            const div = document.createElement('div');
            div.className = `test-result ${success ? 'success' : 'error'}`;
            div.innerHTML = `
                <strong>${success ? '‚úÖ' : '‚ùå'} ${message}</strong>
                ${details ? `<div style="margin-top: 10px; font-size: 14px;">${details}</div>` : ''}
            `;
            resultsContainer.appendChild(div);
        }

        async function runVerification() {
            try {
                // –¢–µ—Å—Ç 1: –°–æ–∑–¥–∞–Ω–∏–µ DataProcessor
                const processor = new DataProcessor();
                addResult('–°–æ–∑–¥–∞–Ω–∏–µ —ç–∫–∑–µ–º–ø–ª—è—Ä–∞ DataProcessor', true);

                // –¢–µ—Å—Ç 2: –ó–∞–≥—Ä—É–∑–∫–∞ –¥–∞–Ω–Ω—ã—Ö
                const loadResult = await DataLoader.loadMusicDataWithResult();
                const dataLoaded = loadResult.success && loadResult.data;
                addResult('–ó–∞–≥—Ä—É–∑–∫–∞ –¥–∞–Ω–Ω—ã—Ö —á–µ—Ä–µ–∑ DataLoader', dataLoaded, 
                    dataLoaded ? `–ó–∞–≥—Ä—É–∂–µ–Ω–æ ${loadResult.data.tracks.length} —Ç—Ä–µ–∫–æ–≤` : loadResult.error);

                if (!dataLoaded) return;

                // –¢–µ—Å—Ç 3: –ö–æ–Ω–≤–µ—Ä—Ç–∞—Ü–∏—è –¥–∞–Ω–Ω—ã—Ö –Ø–Ω–¥–µ–∫—Å.–ú—É–∑—ã–∫–∏
                const convertedTracks = processor.convertYandexTrackData(loadResult.data.tracks);
                const conversionSuccess = convertedTracks.length > 0;
                addResult('–ö–æ–Ω–≤–µ—Ä—Ç–∞—Ü–∏—è –¥–∞–Ω–Ω—ã—Ö –Ø–Ω–¥–µ–∫—Å.–ú—É–∑—ã–∫–∏', conversionSuccess,
                    `–ö–æ–Ω–≤–µ—Ä—Ç–∏—Ä–æ–≤–∞–Ω–æ ${convertedTracks.length} –∏–∑ ${loadResult.data.tracks.length} —Ç—Ä–µ–∫–æ–≤`);

                // –¢–µ—Å—Ç 4: –û–±—Ä–∞–±–æ—Ç–∫–∞ —Ç—Ä–µ–∫–æ–≤ –¥–ª—è 3D-—Å—Ü–µ–Ω—ã
                const processedTracks = processor.processTrackData(convertedTracks);
                const processingSuccess = processedTracks.length === convertedTracks.length;
                addResult('–û–±—Ä–∞–±–æ—Ç–∫–∞ —Ç—Ä–µ–∫–æ–≤ –¥–ª—è 3D-–≤–∏–∑—É–∞–ª–∏–∑–∞—Ü–∏–∏', processingSuccess,
                    `–û–±—Ä–∞–±–æ—Ç–∞–Ω–æ ${processedTracks.length} —Ç—Ä–µ–∫–æ–≤`);

                // –¢–µ—Å—Ç 5: –ê–Ω–∞–ª–∏–∑ –∂–∞–Ω—Ä–æ–≤
                const genreStats = processor.analyzeGenres(convertedTracks);
                const genreAnalysisSuccess = Object.keys(genreStats).length > 0;
                addResult('–ê–Ω–∞–ª–∏–∑ –∂–∞–Ω—Ä–æ–≤', genreAnalysisSuccess,
                    `–ù–∞–π–¥–µ–Ω–æ ${Object.keys(genreStats).length} —É–Ω–∏–∫–∞–ª—å–Ω—ã—Ö –∂–∞–Ω—Ä–æ–≤`);

                // –¢–µ—Å—Ç 6: –ü—Ä–æ–≤–µ—Ä–∫–∞ –º–µ—Ç–æ–¥–æ–≤ –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–∞
                const testTrack = convertedTracks[0];
                
                const popularity = processor.calculatePopularity(testTrack);
                const popularityValid = popularity >= 0 && popularity <= 100;
                addResult('–í—ã—á–∏—Å–ª–µ–Ω–∏–µ –ø–æ–ø—É–ª—è—Ä–Ω–æ—Å—Ç–∏', popularityValid,
                    `–ü–æ–ø—É–ª—è—Ä–Ω–æ—Å—Ç—å: ${popularity} (–¥–∏–∞–ø–∞–∑–æ–Ω: 0-100)`);

                const size = processor.calculateSize(testTrack);
                const sizeValid = size >= 0.5 && size <= 3.0;
                addResult('–í—ã—á–∏—Å–ª–µ–Ω–∏–µ —Ä–∞–∑–º–µ—Ä–∞', sizeValid,
                    `–†–∞–∑–º–µ—Ä: ${size} (–¥–∏–∞–ø–∞–∑–æ–Ω: 0.5-3.0)`);

                const position = processor.calculatePosition(0, 10, testTrack.genre);
                const positionValid = position && typeof position.x === 'number';
                addResult('–í—ã—á–∏—Å–ª–µ–Ω–∏–µ –ø–æ–∑–∏—Ü–∏–∏ (—Å—Ñ–µ—Ä–∏—á–µ—Å–∫–æ–µ —Ä–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ)', positionValid,
                    positionValid ? `–ü–æ–∑–∏—Ü–∏—è: (${position.x.toFixed(2)}, ${position.y.toFixed(2)}, ${position.z.toFixed(2)})` : '–û—à–∏–±–∫–∞ —Å–æ–∑–¥–∞–Ω–∏—è –ø–æ–∑–∏—Ü–∏–∏');

                const color = processor.getGenreColor(testTrack.genre);
                const colorValid = color && color.startsWith('#');
                addResult('–û–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ —Ü–≤–µ—Ç–∞ –ø–æ –∂–∞–Ω—Ä—É', colorValid,
                    `–¶–≤–µ—Ç –¥–ª—è –∂–∞–Ω—Ä–∞ "${testTrack.genre}": ${color}`);

                // –û—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏
                if (processingSuccess) {
                    const stats = processor.getProcessingStats(processedTracks);
                    statsContainer.innerHTML = `
                        <div class="stats">
                            <div class="stat-card">
                                <div class="stat-value">${stats.totalTracks}</div>
                                <div class="stat-label">–í—Å–µ–≥–æ —Ç—Ä–µ–∫–æ–≤</div>
                            </div>
                            <div class="stat-card">
                                <div class="stat-value">${stats.averagePopularity}</div>
                                <div class="stat-label">–°—Ä–µ–¥–Ω—è—è –ø–æ–ø—É–ª—è—Ä–Ω–æ—Å—Ç—å</div>
                            </div>
                            <div class="stat-card">
                                <div class="stat-value">${stats.averageSize}</div>
                                <div class="stat-label">–°—Ä–µ–¥–Ω–∏–π —Ä–∞–∑–º–µ—Ä</div>
                            </div>
                            <div class="stat-card">
                                <div class="stat-value">${Object.keys(stats.genreDistribution).length}</div>
                                <div class="stat-label">–ñ–∞–Ω—Ä–æ–≤</div>
                            </div>
                        </div>
                    `;
                }

                // –û—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ —Ü–≤–µ—Ç–æ–≤ –∂–∞–Ω—Ä–æ–≤
                if (genreAnalysisSuccess) {
                    const genreEntries = Object.entries(genreStats).sort(([,a], [,b]) => b.count - a.count);
                    genreColorsContainer.innerHTML = genreEntries.map(([genre, stats]) => `
                        <div style="display: flex; align-items: center; margin: 10px 0; padding: 10px; background: #333; border-radius: 4px;">
                            <div style="width: 30px; height: 30px; background: ${stats.color}; border-radius: 4px; margin-right: 15px;"></div>
                            <div>
                                <strong>${genre}</strong><br>
                                <small>${stats.count} —Ç—Ä–µ–∫–æ–≤ (${stats.percentage.toFixed(1)}%)</small>
                            </div>
                        </div>
                    `).join('');
                }

                // –ü—Ä–∏–º–µ—Ä—ã –ø–æ–∑–∏—Ü–∏–π –¥–ª—è —Ä–∞–∑–Ω—ã—Ö –∂–∞–Ω—Ä–æ–≤
                const genres = Object.keys(genreStats).slice(0, 5);
                const positionExamples = genres.map(genre => {
                    const pos = processor.calculatePosition(Math.floor(Math.random() * 10), 10, genre);
                    const distance = Math.sqrt(pos.x * pos.x + pos.y * pos.y + pos.z * pos.z);
                    return { genre, position: pos, distance };
                });

                positionExamplesContainer.innerHTML = `
                    <div class="code">
                        ${positionExamples.map(({ genre, position, distance }) => 
                            `${genre}: (${position.x.toFixed(1)}, ${position.y.toFixed(1)}, ${position.z.toFixed(1)}) - —Ä–∞—Å—Å—Ç–æ—è–Ω–∏–µ: ${distance.toFixed(1)}`
                        ).join('<br>')}
                    </div>
                    <small>–ü–æ–∑–∏—Ü–∏–∏ –≥–µ–Ω–µ—Ä–∏—Ä—É—é—Ç—Å—è —Å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ–º —Å—Ñ–µ—Ä–∏—á–µ—Å–∫–æ–≥–æ —Ä–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è –≤ —Ä–∞–¥–∏—É—Å–µ ~50 –µ–¥–∏–Ω–∏—Ü</small>
                `;

                // –§–∏–Ω–∞–ª—å–Ω—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç
                addResult('–ó–∞–¥–∞—á–∞ 6 –≤—ã–ø–æ–ª–Ω–µ–Ω–∞ —É—Å–ø–µ—à–Ω–æ! üéâ', true,
                    'DataProcessor –≥–æ—Ç–æ–≤ –∫ –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏ —Å 3D-—Å—Ü–µ–Ω–æ–π. –í—Å–µ —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è (2.2, 2.3, 2.4, 2.5, 2.6) –≤—ã–ø–æ–ª–Ω–µ–Ω—ã.');

            } catch (error) {
                addResult('–ö—Ä–∏—Ç–∏—á–µ—Å–∫–∞—è –æ—à–∏–±–∫–∞ –ø—Ä–æ–≤–µ—Ä–∫–∏', false, error.message);
                console.error('–û—à–∏–±–∫–∞:', error);
            }
        }

        // –ó–∞–ø—É—Å–∫ –ø—Ä–æ–≤–µ—Ä–∫–∏
        runVerification();
    </script>
</body>
</html>
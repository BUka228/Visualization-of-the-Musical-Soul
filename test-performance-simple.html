<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–ü—Ä–æ—Å—Ç–æ–π —Ç–µ—Å—Ç –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏</title>
    <style>
        body {
            margin: 0;
            padding: 0;
            background: #000;
            color: #fff;
            font-family: Arial, sans-serif;
            overflow: hidden;
        }
        
        #container {
            width: 100vw;
            height: 100vh;
            position: relative;
        }
        
        #info {
            position: absolute;
            top: 10px;
            left: 10px;
            background: rgba(0, 0, 0, 0.8);
            padding: 15px;
            border-radius: 8px;
            border: 1px solid #333;
            font-size: 14px;
            z-index: 1000;
            max-width: 400px;
        }
        
        #info h3 {
            margin: 0 0 10px 0;
            color: #4CAF50;
        }
        
        .stat {
            margin: 5px 0;
        }
        
        .controls {
            position: absolute;
            top: 10px;
            right: 10px;
            background: rgba(0, 0, 0, 0.8);
            padding: 15px;
            border-radius: 8px;
            border: 1px solid #333;
            z-index: 1000;
        }
        
        .controls button {
            background: #4CAF50;
            color: white;
            border: none;
            padding: 8px 12px;
            border-radius: 4px;
            cursor: pointer;
            margin: 2px;
        }
        
        .controls button:hover {
            background: #45a049;
        }
    </style>
</head>
<body>
    <div id="container"></div>
    
    <div id="info">
        <h3>üöÄ –¢–µ—Å—Ç –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏</h3>
        <div class="stat">–°—Ç–∞—Ç—É—Å: <span id="status">–ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è...</span></div>
        <div class="stat">–¢—Ä–µ–∫–æ–≤ —Å–æ–∑–¥–∞–Ω–æ: <span id="track-count">0</span></div>
        <div class="stat">FPS: <span id="fps">0</span></div>
        <div class="stat">–ò–Ω—Å—Ç–∞–Ω—Å–∏—Ä–æ–≤–∞–Ω–Ω—ã—Ö –æ–±—ä–µ–∫—Ç–æ–≤: <span id="instanced">0</span></div>
        <div class="stat">–û—Ç—Å–µ—á–µ–Ω–Ω—ã—Ö –æ–±—ä–µ–∫—Ç–æ–≤: <span id="culled">0</span></div>
        <div class="stat">–°–æ–∫—Ä–∞—â–µ–Ω–æ draw calls: <span id="draw-calls-saved">0</span></div>
        <div class="stat">–ü–µ—Ä–µ–∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–Ω—ã—Ö —Ä–µ—Å—É—Ä—Å–æ–≤: <span id="reused-resources">0</span></div>
        <div id="console-output" style="margin-top: 10px; font-family: monospace; font-size: 12px; max-height: 200px; overflow-y: auto;"></div>
    </div>
    
    <div class="controls">
        <h3>‚öôÔ∏è –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ</h3>
        <button onclick="generateReport()">üìã –û—Ç—á–µ—Ç</button>
        <button onclick="addObjects()">‚ûï –î–æ–±–∞–≤–∏—Ç—å –æ–±—ä–µ–∫—Ç—ã</button>
        <button onclick="resetScene()">üîÑ –°–±—Ä–æ—Å</button>
    </div>

    <script src="./dist/bundle.js"></script>
    <script>
        // –ì–ª–æ–±–∞–ª—å–Ω—ã–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ
        let app;
        let trackCount = 0;
        
        // –§—É–Ω–∫—Ü–∏—è –¥–ª—è –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—è –≤ UI
        function logToUI(message) {
            const output = document.getElementById('console-output');
            const div = document.createElement('div');
            div.textContent = new Date().toLocaleTimeString() + ': ' + message;
            output.appendChild(div);
            output.scrollTop = output.scrollHeight;
            console.log(message);
        }
        
        // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏ –≤ UI
        function updateStats() {
            if (app && app.sceneManager) {
                try {
                    const performanceOptimizer = app.sceneManager.getPerformanceOptimizer();
                    if (performanceOptimizer) {
                        const stats = performanceOptimizer.getStats();
                        
                        document.getElementById('track-count').textContent = stats.totalObjects;
                        document.getElementById('fps').textContent = Math.round(stats.currentFps);
                        document.getElementById('instanced').textContent = stats.instancedObjects;
                        document.getElementById('culled').textContent = stats.culledObjects;
                        document.getElementById('draw-calls-saved').textContent = stats.drawCallsReduced;
                        document.getElementById('reused-resources').textContent = stats.reusedResources;
                    }
                } catch (error) {
                    console.warn('–û—à–∏–±–∫–∞ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏:', error);
                }
            }
        }
        
        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è
        async function initApp() {
            try {
                document.getElementById('status').textContent = '–ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è...';
                logToUI('üöÄ –ù–∞—á–∞–ª–æ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è');
                
                // –°–æ–∑–¥–∞–Ω–∏–µ —ç–∫–∑–µ–º–ø–ª—è—Ä–∞ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è
                const container = document.getElementById('container');
                
                // –ò—Å–ø–æ–ª—å–∑—É–µ–º –≥–ª–æ–±–∞–ª—å–Ω—ã–µ –∫–ª–∞—Å—Å—ã –∏–∑ bundle.js
                if (typeof window.MusicGalaxyApplication !== 'undefined') {
                    app = new window.MusicGalaxyApplication();
                    await app.initialize(container);
                    
                    // –ì–µ–Ω–µ—Ä–∞—Ü–∏—è —Ç–µ—Å—Ç–æ–≤—ã—Ö –¥–∞–Ω–Ω—ã—Ö
                    const testTracks = generateTestTracks(300);
                    app.loadTracks(testTracks);
                    trackCount = testTracks.length;
                    
                    document.getElementById('status').textContent = '–ì–æ—Ç–æ–≤–æ';
                    logToUI(`‚úÖ –ü—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω–æ —Å ${trackCount} —Ç—Ä–µ–∫–∞–º–∏`);
                    
                    // –ó–∞–ø—É—Å–∫ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏
                    setInterval(updateStats, 1000);
                    
                } else {
                    throw new Error('MusicGalaxyApp –Ω–µ –Ω–∞–π–¥–µ–Ω –≤ bundle.js');
                }
                
            } catch (error) {
                document.getElementById('status').textContent = '–û—à–∏–±–∫–∞';
                logToUI('‚ùå –û—à–∏–±–∫–∞ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏: ' + error.message);
                console.error('–û—à–∏–±–∫–∞ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏:', error);
            }
        }
        
        // –ì–µ–Ω–µ—Ä–∞—Ü–∏—è —Ç–µ—Å—Ç–æ–≤—ã—Ö –¥–∞–Ω–Ω—ã—Ö
        function generateTestTracks(count) {
            const genres = ['metal', 'rock', 'indie', 'pop', 'electronic', 'jazz', 'classical', 'hip-hop'];
            const artists = ['Artist A', 'Artist B', 'Artist C', 'Artist D', 'Artist E'];
            const tracks = [];

            for (let i = 0; i < count; i++) {
                const genre = genres[Math.floor(Math.random() * genres.length)];
                const artist = artists[Math.floor(Math.random() * artists.length)];
                
                tracks.push({
                    id: `track_${i}`,
                    name: `Track ${i + 1}`,
                    artist: artist,
                    album: `Album ${Math.floor(i / 10) + 1}`,
                    genre: genre,
                    duration: 180 + Math.random() * 240,
                    popularity: Math.random() * 100,
                    previewUrl: `https://example.com/preview_${i}.mp3`,
                    imageUrl: `https://example.com/cover_${i}.jpg`
                });
            }

            return tracks;
        }
        
        // –ì–ª–æ–±–∞–ª—å–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏ –¥–ª—è –∫–Ω–æ–ø–æ–∫
        window.generateReport = function() {
            if (app && app.sceneManager) {
                try {
                    const performanceOptimizer = app.sceneManager.getPerformanceOptimizer();
                    if (performanceOptimizer) {
                        const report = performanceOptimizer.generateReport();
                        logToUI('üìã –û—Ç—á–µ—Ç —Å–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞–Ω (—Å–º. –∫–æ–Ω—Å–æ–ª—å)');
                        console.log(report);
                        
                        // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –∫—Ä–∞—Ç–∫–∏–π –æ—Ç—á–µ—Ç –≤ UI
                        const stats = performanceOptimizer.getStats();
                        logToUI(`üìä –ö—Ä–∞—Ç–∫–∏–π –æ—Ç—á–µ—Ç: ${stats.totalObjects} –æ–±—ä–µ–∫—Ç–æ–≤, ${stats.instancedObjects} –∏–Ω—Å—Ç–∞–Ω—Å–∏—Ä–æ–≤–∞–Ω–Ω—ã—Ö, ${stats.drawCallsReduced} draw calls —Å–æ–∫—Ä–∞—â–µ–Ω–æ`);
                    }
                } catch (error) {
                    logToUI('‚ùå –û—à–∏–±–∫–∞ –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ –æ—Ç—á–µ—Ç–∞: ' + error.message);
                }
            }
        };
        
        window.addObjects = function() {
            if (app) {
                try {
                    const additionalTracks = generateTestTracks(100);
                    // –ó–¥–µ—Å—å –Ω—É–∂–Ω–æ –±—É–¥–µ—Ç –¥–æ–±–∞–≤–∏—Ç—å –º–µ—Ç–æ–¥ –¥–ª—è –¥–æ–±–∞–≤–ª–µ–Ω–∏—è —Ç—Ä–µ–∫–æ–≤
                    logToUI(`‚ûï –ü–æ–ø—ã—Ç–∫–∞ –¥–æ–±–∞–≤–∏—Ç—å ${additionalTracks.length} –æ–±—ä–µ–∫—Ç–æ–≤`);
                    trackCount += additionalTracks.length;
                } catch (error) {
                    logToUI('‚ùå –û—à–∏–±–∫–∞ –¥–æ–±–∞–≤–ª–µ–Ω–∏—è –æ–±—ä–µ–∫—Ç–æ–≤: ' + error.message);
                }
            }
        };
        
        window.resetScene = function() {
            if (app) {
                try {
                    app.resetView();
                    logToUI('üîÑ –°—Ü–µ–Ω–∞ —Å–±—Ä–æ—à–µ–Ω–∞');
                } catch (error) {
                    logToUI('‚ùå –û—à–∏–±–∫–∞ —Å–±—Ä–æ—Å–∞ —Å—Ü–µ–Ω—ã: ' + error.message);
                }
            }
        };
        
        // –ó–∞–ø—É—Å–∫ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è –ø–æ—Å–ª–µ –∑–∞–≥—Ä—É–∑–∫–∏ —Å—Ç—Ä–∞–Ω–∏—Ü—ã
        window.addEventListener('load', initApp);
    </script>
</body>
</html>
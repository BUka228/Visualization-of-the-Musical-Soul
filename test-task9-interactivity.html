<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Test Task 9 - Object Interactivity</title>
    <style>
        body {
            margin: 0;
            padding: 0;
            overflow: hidden;
            background: #000;
            font-family: 'Arial', sans-serif;
        }
        
        #canvas-container {
            position: relative;
            width: 100vw;
            height: 100vh;
        }
        
        #ui-overlay {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            pointer-events: none;
            z-index: 10;
        }
        
        .ui-panel {
            position: absolute;
            background: rgba(0, 0, 0, 0.8);
            color: white;
            padding: 15px;
            border-radius: 8px;
            pointer-events: auto;
            border: 1px solid rgba(255, 255, 255, 0.2);
        }
        
        #track-info {
            top: 20px;
            left: 20px;
            max-width: 350px;
            display: none;
        }
        
        #track-info h4 {
            margin: 0 0 10px 0;
            color: #4fc3f7;
            font-size: 16px;
        }
        
        #track-info p {
            margin: 5px 0;
            font-size: 14px;
        }
        
        #instructions {
            bottom: 20px;
            left: 20px;
            max-width: 400px;
        }
        
        #instructions h3 {
            margin: 0 0 15px 0;
            color: #4fc3f7;
        }
        
        #instructions ul {
            margin: 10px 0;
            padding-left: 20px;
        }
        
        #instructions li {
            margin: 8px 0;
            line-height: 1.4;
        }
        
        #test-status {
            top: 20px;
            right: 20px;
            max-width: 300px;
        }
        
        .status-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin: 8px 0;
            padding: 5px 0;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
        }
        
        .status-indicator {
            width: 12px;
            height: 12px;
            border-radius: 50%;
            background: #666;
        }
        
        .status-indicator.active {
            background: #4fc3f7;
            box-shadow: 0 0 10px #4fc3f7;
        }
        
        .status-indicator.success {
            background: #4caf50;
            box-shadow: 0 0 10px #4caf50;
        }
        
        #loading {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            color: white;
            font-size: 18px;
            z-index: 100;
        }
    </style>
</head>
<body>
    <div id="canvas-container">
        <div id="loading">–ó–∞–≥—Ä—É–∑–∫–∞ —Ç–µ—Å—Ç–∞ –∏–Ω—Ç–µ—Ä–∞–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏...</div>
        
        <div id="ui-overlay">
            <!-- –ü–∞–Ω–µ–ª—å –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏ –æ —Ç—Ä–µ–∫–µ -->
            <div id="track-info" class="ui-panel">
                <h4 id="track-title">–ù–∞–∑–≤–∞–Ω–∏–µ —Ç—Ä–µ–∫–∞</h4>
                <p id="track-artist">–ò—Å–ø–æ–ª–Ω–∏—Ç–µ–ª—å</p>
                <p id="track-album">–ê–ª—å–±–æ–º</p>
            </div>
            
            <!-- –ò–Ω—Å—Ç—Ä—É–∫—Ü–∏–∏ –ø–æ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—é -->
            <div id="instructions" class="ui-panel">
                <h3>üéÆ –¢–µ—Å—Ç –∏–Ω—Ç–µ—Ä–∞–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏</h3>
                <ul>
                    <li><strong>–ù–∞–≤–µ–¥–µ–Ω–∏–µ –º—ã—à–∏:</strong> –û–±—ä–µ–∫—Ç—ã –¥–æ–ª–∂–Ω—ã –ø–æ–¥—Å–≤–µ—á–∏–≤–∞—Ç—å—Å—è –∏ —É–≤–µ–ª–∏—á–∏–≤–∞—Ç—å—Å—è</li>
                    <li><strong>–ö–ª–∏–∫ –ø–æ –æ–±—ä–µ–∫—Ç—É:</strong> –í—ã–±–æ—Ä —Ç—Ä–µ–∫–∞ —Å –ø—Ä–∏–±–ª–∏–∂–µ–Ω–∏–µ–º –∫–∞–º–µ—Ä—ã</li>
                    <li><strong>–ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ —Ç—Ä–µ–∫–µ:</strong> –û—Ç–æ–±—Ä–∞–∂–∞–µ—Ç—Å—è –≤ –ª–µ–≤–æ–º –≤–µ—Ä—Ö–Ω–µ–º —É–≥–ª—É</li>
                    <li><strong>–ö–ª–∏–∫ –≤ –ø—É—Å—Ç–æ—Ç—É:</strong> –û—Ç–º–µ–Ω–∞ –≤—ã–±–æ—Ä–∞ –∏ –≤–æ–∑–≤—Ä–∞—Ç –∫–∞–º–µ—Ä—ã</li>
                    <li><strong>R:</strong> –°–±—Ä–æ—Å –∫–∞–º–µ—Ä—ã –≤ –∏—Å—Ö–æ–¥–Ω–æ–µ –ø–æ–ª–æ–∂–µ–Ω–∏–µ</li>
                    <li><strong>–ü—Ä–æ–±–µ–ª:</strong> –ü–∞—É–∑–∞/–≤–æ–∑–æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ –∞–Ω–∏–º–∞—Ü–∏–∏</li>
                </ul>
            </div>
            
            <!-- –°—Ç–∞—Ç—É—Å —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è -->
            <div id="test-status" class="ui-panel">
                <h3>üìä –°—Ç–∞—Ç—É—Å —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è</h3>
                <div class="status-item">
                    <span>Raycasting</span>
                    <div id="raycasting-status" class="status-indicator"></div>
                </div>
                <div class="status-item">
                    <span>Hover —ç—Ñ—Ñ–µ–∫—Ç—ã</span>
                    <div id="hover-status" class="status-indicator"></div>
                </div>
                <div class="status-item">
                    <span>–í—ã–±–æ—Ä –æ–±—ä–µ–∫—Ç–æ–≤</span>
                    <div id="selection-status" class="status-indicator"></div>
                </div>
                <div class="status-item">
                    <span>–ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ —Ç—Ä–µ–∫–µ</span>
                    <div id="info-status" class="status-indicator"></div>
                </div>
                <div class="status-item">
                    <span>–ê–Ω–∏–º–∞—Ü–∏—è –∫–∞–º–µ—Ä—ã</span>
                    <div id="camera-status" class="status-indicator"></div>
                </div>
            </div>
        </div>
    </div>

    <script type="module">
        import * as THREE from 'three';
        import { SceneManager } from './src/scene/SceneManager.js';
        import { DataProcessor } from './src/data/DataProcessor.js';

        // –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è –¥–ª—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è
        const testConfig = {
            galaxyRadius: 30,
            objectMinSize: 0.8,
            objectMaxSize: 2.5,
            animationSpeed: 0.001,
            cameraDistance: 80,
            genreColors: {
                'metal': '#FF0000',
                'rock': '#FF4500', 
                'indie': '#4169E1',
                'pop': '#FFD700',
                'electronic': '#9400D3',
                'jazz': '#228B22',
                'default': '#FFFFFF'
            }
        };

        // –°–æ–∑–¥–∞–Ω–∏–µ —Ç–µ—Å—Ç–æ–≤—ã—Ö –¥–∞–Ω–Ω—ã—Ö
        function createTestTracks() {
            const genres = ['metal', 'rock', 'indie', 'pop', 'electronic', 'jazz'];
            const tracks = [];
            
            for (let i = 0; i < 20; i++) {
                const genre = genres[i % genres.length];
                tracks.push({
                    id: `test-track-${i}`,
                    name: `–¢–µ—Å—Ç–æ–≤—ã–π —Ç—Ä–µ–∫ ${i + 1}`,
                    artist: `–ò—Å–ø–æ–ª–Ω–∏—Ç–µ–ª—å ${Math.floor(i / 3) + 1}`,
                    album: `–ê–ª—å–±–æ–º ${Math.floor(i / 5) + 1}`,
                    genre: genre,
                    duration: 180 + Math.random() * 120, // 3-5 –º–∏–Ω—É—Ç
                    popularity: Math.floor(Math.random() * 100),
                    previewUrl: `https://example.com/preview-${i}.mp3`
                });
            }
            
            return tracks;
        }

        // –°—Ç–∞—Ç—É—Å –∏–Ω–¥–∏–∫–∞—Ç–æ—Ä—ã
        const statusIndicators = {
            raycasting: document.getElementById('raycasting-status'),
            hover: document.getElementById('hover-status'),
            selection: document.getElementById('selection-status'),
            info: document.getElementById('info-status'),
            camera: document.getElementById('camera-status')
        };

        function updateStatus(indicator, active = false, success = false) {
            indicator.className = 'status-indicator';
            if (success) {
                indicator.classList.add('success');
            } else if (active) {
                indicator.classList.add('active');
            }
        }

        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è —Ç–µ—Å—Ç–∞
        async function initTest() {
            try {
                const container = document.getElementById('canvas-container');
                
                // –°–æ–∑–¥–∞–Ω–∏–µ SceneManager
                const sceneManager = new SceneManager(container, testConfig);
                sceneManager.initializeScene();
                
                // –°–æ–∑–¥–∞–Ω–∏–µ —Ç–µ—Å—Ç–æ–≤—ã—Ö –¥–∞–Ω–Ω—ã—Ö
                const testTracks = createTestTracks();
                const dataProcessor = new DataProcessor();
                const processedTracks = dataProcessor.processTrackData(testTracks);
                
                // –ó–∞–≥—Ä—É–∑–∫–∞ —Ç—Ä–µ–∫–æ–≤ –≤ —Å—Ü–µ–Ω—É
                sceneManager.createTrackObjects(processedTracks);
                
                // –ü–æ–ª—É—á–µ–Ω–∏–µ –º–µ–Ω–µ–¥–∂–µ—Ä–∞ –≤–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–∏—è
                const interactionManager = sceneManager.getInteractionManager();
                
                // –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–æ–≤ —Å–æ–±—ã—Ç–∏–π –¥–ª—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è
                setupTestEventHandlers(interactionManager);
                
                // –°–∫—Ä—ã—Ç–∏–µ –∏–Ω–¥–∏–∫–∞—Ç–æ—Ä–∞ –∑–∞–≥—Ä—É–∑–∫–∏
                document.getElementById('loading').style.display = 'none';
                
                console.log('‚úÖ –¢–µ—Å—Ç –∏–Ω—Ç–µ—Ä–∞–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω');
                console.log(`üìä –°–æ–∑–¥–∞–Ω–æ ${processedTracks.length} —Ç–µ—Å—Ç–æ–≤—ã—Ö –æ–±—ä–µ–∫—Ç–æ–≤`);
                
            } catch (error) {
                console.error('‚ùå –û—à–∏–±–∫–∞ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏ —Ç–µ—Å—Ç–∞:', error);
                document.getElementById('loading').innerHTML = `
                    <div style="color: #ff6b6b;">
                        <h3>–û—à–∏–±–∫–∞ —Ç–µ—Å—Ç–∞</h3>
                        <p>${error.message}</p>
                    </div>
                `;
            }
        }

        function setupTestEventHandlers(interactionManager) {
            let hoverCount = 0;
            let selectionCount = 0;
            let infoDisplayCount = 0;
            let cameraAnimationCount = 0;

            // –û–±—Ä–∞–±–æ—Ç—á–∏–∫ –Ω–∞–≤–µ–¥–µ–Ω–∏—è
            interactionManager.setOnTrackHovered((track) => {
                hoverCount++;
                updateStatus(statusIndicators.hover, true);
                updateStatus(statusIndicators.raycasting, false, true);
                console.log(`üéØ Hover: ${track.trackData?.name || '–¢–µ—Å—Ç–æ–≤—ã–π –æ–±—ä–µ–∫—Ç'} (${hoverCount})`);
            });

            // –û–±—Ä–∞–±–æ—Ç—á–∏–∫ —Å–Ω—è—Ç–∏—è –Ω–∞–≤–µ–¥–µ–Ω–∏—è
            interactionManager.setOnTrackUnhovered(() => {
                updateStatus(statusIndicators.hover, false);
                console.log('üéØ Hover —Å–Ω—è—Ç');
            });

            // –û–±—Ä–∞–±–æ—Ç—á–∏–∫ –≤—ã–±–æ—Ä–∞ —Ç—Ä–µ–∫–∞
            interactionManager.setOnTrackSelected((track) => {
                selectionCount++;
                infoDisplayCount++;
                cameraAnimationCount++;
                
                updateStatus(statusIndicators.selection, false, true);
                updateStatus(statusIndicators.info, false, true);
                updateStatus(statusIndicators.camera, true);
                
                console.log(`üéµ –í—ã–±—Ä–∞–Ω —Ç—Ä–µ–∫: ${track.trackData?.name || '–¢–µ—Å—Ç–æ–≤—ã–π –æ–±—ä–µ–∫—Ç'} (${selectionCount})`);
                
                // –ü—Ä–æ–≤–µ—Ä—è–µ–º, —á—Ç–æ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ —Ç—Ä–µ–∫–µ –æ—Ç–æ–±—Ä–∞–∂–∞–µ—Ç—Å—è
                const trackInfoPanel = document.getElementById('track-info');
                if (trackInfoPanel && trackInfoPanel.style.display === 'block') {
                    console.log('‚úÖ –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ —Ç—Ä–µ–∫–µ –æ—Ç–æ–±—Ä–∞–∂–∞–µ—Ç—Å—è –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ');
                }
                
                // –ò–º–∏—Ç–∏—Ä—É–µ–º –∑–∞–≤–µ—Ä—à–µ–Ω–∏–µ –∞–Ω–∏–º–∞—Ü–∏–∏ –∫–∞–º–µ—Ä—ã —á–µ—Ä–µ–∑ 1 —Å–µ–∫—É–Ω–¥—É
                setTimeout(() => {
                    updateStatus(statusIndicators.camera, false, true);
                    console.log('üì∑ –ê–Ω–∏–º–∞—Ü–∏—è –∫–∞–º–µ—Ä—ã –∑–∞–≤–µ—Ä—à–µ–Ω–∞');
                }, 1000);
            });

            // –û–±—Ä–∞–±–æ—Ç—á–∏–∫ –æ—Ç–º–µ–Ω—ã –≤—ã–±–æ—Ä–∞
            interactionManager.setOnTrackDeselected(() => {
                updateStatus(statusIndicators.selection, false);
                updateStatus(statusIndicators.info, false);
                updateStatus(statusIndicators.camera, true);
                
                console.log('üéµ –í—ã–±–æ—Ä —Ç—Ä–µ–∫–∞ –æ—Ç–º–µ–Ω–µ–Ω');
                
                // –ü—Ä–æ–≤–µ—Ä—è–µ–º, —á—Ç–æ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ —Ç—Ä–µ–∫–µ —Å–∫—Ä—ã—Ç–∞
                setTimeout(() => {
                    const trackInfoPanel = document.getElementById('track-info');
                    if (trackInfoPanel && trackInfoPanel.style.display === 'none') {
                        console.log('‚úÖ –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ —Ç—Ä–µ–∫–µ —Å–∫—Ä—ã—Ç–∞ –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ');
                    }
                    updateStatus(statusIndicators.camera, false, true);
                }, 300);
            });

            // –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ –∫–ª–∞–≤–∏–∞—Ç—É—Ä—ã –¥–ª—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è
            document.addEventListener('keydown', (event) => {
                switch (event.code) {
                    case 'KeyT':
                        // –¢–µ—Å—Ç–æ–≤–∞—è –∫–ª–∞–≤–∏—à–∞ –¥–ª—è –≤—ã–≤–æ–¥–∞ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏
                        console.log('üìä –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è:');
                        console.log(`  - –ù–∞–≤–µ–¥–µ–Ω–∏–π: ${hoverCount}`);
                        console.log(`  - –í—ã–±–æ—Ä–æ–≤: ${selectionCount}`);
                        console.log(`  - –û—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–π –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏: ${infoDisplayCount}`);
                        console.log(`  - –ê–Ω–∏–º–∞—Ü–∏–π –∫–∞–º–µ—Ä—ã: ${cameraAnimationCount}`);
                        break;
                }
            });

            console.log('üéÆ –û–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ —Å–æ–±—ã—Ç–∏–π –¥–ª—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è –Ω–∞—Å—Ç—Ä–æ–µ–Ω—ã');
            console.log('üí° –ù–∞–∂–º–∏—Ç–µ T –¥–ª—è –≤—ã–≤–æ–¥–∞ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è');
        }

        // –ó–∞–ø—É—Å–∫ —Ç–µ—Å—Ç–∞ –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ —Å—Ç—Ä–∞–Ω–∏—Ü—ã
        document.addEventListener('DOMContentLoaded', initTest);
    </script>
</body>
</html>
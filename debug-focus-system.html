<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Debug Focus System</title>
    <style>
        body {
            margin: 0;
            padding: 20px;
            font-family: Arial, sans-serif;
            background: #1a1a1a;
            color: #fff;
        }
        
        .debug-panel {
            position: fixed;
            top: 20px;
            right: 20px;
            background: rgba(0, 0, 0, 0.8);
            padding: 15px;
            border-radius: 8px;
            border: 1px solid #333;
            min-width: 300px;
            z-index: 1000;
        }
        
        .debug-item {
            margin: 5px 0;
            padding: 5px;
            border-radius: 4px;
        }
        
        .debug-item.active {
            background: rgba(0, 255, 0, 0.2);
            border: 1px solid #0f0;
        }
        
        .debug-item.warning {
            background: rgba(255, 255, 0, 0.2);
            border: 1px solid #ff0;
        }
        
        .debug-item.error {
            background: rgba(255, 0, 0, 0.2);
            border: 1px solid #f00;
        }
        
        .debug-log {
            max-height: 200px;
            overflow-y: auto;
            background: rgba(0, 0, 0, 0.5);
            padding: 10px;
            margin-top: 10px;
            border-radius: 4px;
            font-family: monospace;
            font-size: 12px;
        }
        
        .log-entry {
            margin: 2px 0;
            padding: 2px 5px;
            border-radius: 2px;
        }
        
        .log-entry.focus { background: rgba(0, 255, 0, 0.1); }
        .log-entry.performance { background: rgba(255, 255, 0, 0.1); }
        .log-entry.error { background: rgba(255, 0, 0, 0.1); }
        
        button {
            background: #333;
            color: #fff;
            border: 1px solid #555;
            padding: 8px 12px;
            border-radius: 4px;
            cursor: pointer;
            margin: 5px;
        }
        
        button:hover {
            background: #555;
        }
        
        button:active {
            background: #222;
        }
    </style>
</head>
<body>
    <h1>Debug Focus System</h1>
    <p>–≠—Ç–æ—Ç –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç –ø–æ–º–æ–∂–µ—Ç –¥–∏–∞–≥–Ω–æ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å –ø—Ä–æ–±–ª–µ–º—ã —Å —Å–∏—Å—Ç–µ–º–æ–π —Ñ–æ–∫—É—Å–∞ –∫–∞–º–µ—Ä—ã.</p>
    
    <div class="debug-panel">
        <h3>üîç Focus System Status</h3>
        
        <div class="debug-item" id="focus-animating">
            <strong>Camera Focus Animating:</strong> <span id="focus-animating-value">false</span>
        </div>
        
        <div class="debug-item" id="global-protection">
            <strong>Global Focus Protection:</strong> <span id="global-protection-value">false</span>
        </div>
        
        <div class="debug-item" id="focused-crystal">
            <strong>Focused Crystal:</strong> <span id="focused-crystal-value">none</span>
        </div>
        
        <div class="debug-item" id="performance-fps">
            <strong>Current FPS:</strong> <span id="performance-fps-value">--</span>
        </div>
        
        <div class="debug-item" id="last-focus-end">
            <strong>Last Focus End:</strong> <span id="last-focus-end-value">never</span>
        </div>
        
        <div>
            <button onclick="simulateFocus()">üéØ Simulate Focus</button>
            <button onclick="simulatePerformanceDrop()">‚ö° Simulate Performance Drop</button>
            <button onclick="clearLogs()">üóëÔ∏è Clear Logs</button>
        </div>
        
        <div class="debug-log" id="debug-log">
            <div class="log-entry">Debug log initialized...</div>
        </div>
    </div>

    <script>
        // –ì–ª–æ–±–∞–ª—å–Ω—ã–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –¥–ª—è –æ—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏—è —Å–æ—Å—Ç–æ—è–Ω–∏—è
        let debugInterval;
        let logEntries = [];
        
        // –§—É–Ω–∫—Ü–∏—è –¥–ª—è –¥–æ–±–∞–≤–ª–µ–Ω–∏—è –∑–∞–ø–∏—Å–∏ –≤ –ª–æ–≥
        function addLogEntry(message, type = 'info') {
            const timestamp = new Date().toLocaleTimeString();
            const entry = `[${timestamp}] ${message}`;
            logEntries.push({ entry, type, timestamp: Date.now() });
            
            // –û–≥—Ä–∞–Ω–∏—á–∏–≤–∞–µ–º –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –∑–∞–ø–∏—Å–µ–π
            if (logEntries.length > 100) {
                logEntries = logEntries.slice(-100);
            }
            
            updateLogDisplay();
        }
        
        // –û–±–Ω–æ–≤–ª—è–µ—Ç –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ –ª–æ–≥–∞
        function updateLogDisplay() {
            const logContainer = document.getElementById('debug-log');
            logContainer.innerHTML = logEntries.map(({ entry, type }) => 
                `<div class="log-entry ${type}">${entry}</div>`
            ).join('');
            logContainer.scrollTop = logContainer.scrollHeight;
        }
        
        // –û–±–Ω–æ–≤–ª—è–µ—Ç —Å—Ç–∞—Ç—É—Å —Å–∏—Å—Ç–µ–º—ã —Ñ–æ–∫—É—Å–∞
        function updateFocusStatus() {
            // –ü—Ä–æ–≤–µ—Ä—è–µ–º –≥–ª–æ–±–∞–ª—å–Ω—ã–µ —Ñ–ª–∞–≥–∏
            const isFocusAnimating = window.isCameraFocusAnimating || false;
            const globalProtection = window.globalFocusProtection || false;
            const lastFocusEnd = window.lastFocusEndTime || 0;
            
            // –û–±–Ω–æ–≤–ª—è–µ–º UI
            const focusAnimatingEl = document.getElementById('focus-animating');
            const focusAnimatingValue = document.getElementById('focus-animating-value');
            focusAnimatingValue.textContent = isFocusAnimating.toString();
            focusAnimatingEl.className = `debug-item ${isFocusAnimating ? 'active' : ''}`;
            
            const globalProtectionEl = document.getElementById('global-protection');
            const globalProtectionValue = document.getElementById('global-protection-value');
            globalProtectionValue.textContent = globalProtection.toString();
            globalProtectionEl.className = `debug-item ${globalProtection ? 'active' : ''}`;
            
            // –ü—Ä–æ–≤–µ—Ä—è–µ–º —Å—Ñ–æ–∫—É—Å–∏—Ä–æ–≤–∞–Ω–Ω—ã–π –∫—Ä–∏—Å—Ç–∞–ª–ª
            let focusedCrystal = 'none';
            if (window.crystalTrackSystem && typeof window.crystalTrackSystem.getFocusedCrystal === 'function') {
                const crystal = window.crystalTrackSystem.getFocusedCrystal();
                if (crystal) {
                    focusedCrystal = `${crystal.name} by ${crystal.artist}`;
                }
            }
            
            const focusedCrystalEl = document.getElementById('focused-crystal');
            const focusedCrystalValue = document.getElementById('focused-crystal-value');
            focusedCrystalValue.textContent = focusedCrystal;
            focusedCrystalEl.className = `debug-item ${focusedCrystal !== 'none' ? 'active' : ''}`;
            
            // –ü—Ä–æ–≤–µ—Ä—è–µ–º FPS
            let currentFPS = '--';
            if (window.performanceOptimizer && typeof window.performanceOptimizer.getStats === 'function') {
                const stats = window.performanceOptimizer.getStats();
                currentFPS = stats.currentFps ? stats.currentFps.toFixed(1) : '--';
            }
            
            const performanceFpsEl = document.getElementById('performance-fps');
            const performanceFpsValue = document.getElementById('performance-fps-value');
            performanceFpsValue.textContent = currentFPS;
            const fps = parseFloat(currentFPS);
            performanceFpsEl.className = `debug-item ${fps < 30 ? 'error' : fps < 50 ? 'warning' : ''}`;
            
            // –í—Ä–µ–º—è –ø–æ—Å–ª–µ–¥–Ω–µ–≥–æ –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è —Ñ–æ–∫—É—Å–∞
            const lastFocusEndEl = document.getElementById('last-focus-end');
            const lastFocusEndValue = document.getElementById('last-focus-end-value');
            if (lastFocusEnd > 0) {
                const timeSince = Date.now() - lastFocusEnd;
                lastFocusEndValue.textContent = `${Math.round(timeSince / 1000)}s ago`;
                lastFocusEndEl.className = `debug-item ${timeSince < 15000 ? 'warning' : ''}`;
            } else {
                lastFocusEndValue.textContent = 'never';
                lastFocusEndEl.className = 'debug-item';
            }
        }
        
        // –°–∏–º—É–ª–∏—Ä—É–µ—Ç —Ñ–æ–∫—É—Å –Ω–∞ –∫—Ä–∏—Å—Ç–∞–ª–ª
        function simulateFocus() {
            addLogEntry('üéØ Simulating focus animation...', 'focus');
            
            // –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –≥–ª–æ–±–∞–ª—å–Ω—ã–µ —Ñ–ª–∞–≥–∏
            window.isCameraFocusAnimating = true;
            window.globalFocusProtection = true;
            
            addLogEntry('üõ°Ô∏è Global focus protection enabled', 'focus');
            
            // –°–∏–º—É–ª–∏—Ä—É–µ–º –∞–Ω–∏–º–∞—Ü–∏—é —Ñ–æ–∫—É—Å–∞
            setTimeout(() => {
                addLogEntry('‚úÖ Focus animation completed', 'focus');
                window.isCameraFocusAnimating = false;
                
                // –ó–∞–¥–µ—Ä–∂–∫–∞ –ø–µ—Ä–µ–¥ —Å–±—Ä–æ—Å–æ–º –∑–∞—â–∏—Ç—ã
                setTimeout(() => {
                    window.globalFocusProtection = false;
                    window.lastFocusEndTime = Date.now();
                    addLogEntry('üîì Global focus protection disabled', 'focus');
                }, 5000);
            }, 2000);
        }
        
        // –°–∏–º—É–ª–∏—Ä—É–µ—Ç –ø–∞–¥–µ–Ω–∏–µ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏
        function simulatePerformanceDrop() {
            addLogEntry('‚ö° Simulating performance drop...', 'performance');
            
            // –°–∏–º—É–ª–∏—Ä—É–µ–º –Ω–∏–∑–∫–∏–π FPS
            if (window.performanceOptimizer) {
                // –°–æ–∑–¥–∞–µ–º —Ñ–µ–π–∫–æ–≤–æ–µ –ø—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏–µ –æ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏
                const fakeWarning = {
                    type: 'low_fps',
                    severity: 'MEDIUM',
                    message: '–ù–∏–∑–∫–∏–π FPS: 18.4. –í–æ–∑–º–æ–∂–Ω—ã –ø—Ä–æ–±–ª–µ–º—ã —Å –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å—é.',
                    value: 18.4,
                    threshold: 30,
                    timestamp: Date.now()
                };
                
                addLogEntry(`üìä Performance warning: ${fakeWarning.message}`, 'performance');
                
                // –ü—Ä–æ–≤–µ—Ä—è–µ–º, –∑–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω–∞ –ª–∏ –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è
                const isFocusAnimating = window.isCameraFocusAnimating || false;
                const globalProtection = window.globalFocusProtection || false;
                
                if (isFocusAnimating || globalProtection) {
                    addLogEntry('‚è∏Ô∏è Performance optimization blocked by focus protection', 'performance');
                } else {
                    addLogEntry('üîß Performance optimization would be applied', 'performance');
                }
            }
        }
        
        // –û—á–∏—â–∞–µ—Ç –ª–æ–≥–∏
        function clearLogs() {
            logEntries = [];
            updateLogDisplay();
            addLogEntry('Debug log cleared', 'info');
        }
        
        // –ü–µ—Ä–µ—Ö–≤–∞—Ç—ã–≤–∞–µ–º –∫–æ–Ω—Å–æ–ª—å–Ω—ã–µ —Å–æ–æ–±—â–µ–Ω–∏—è –¥–ª—è –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è –≤ –ª–æ–≥–µ
        const originalConsoleLog = console.log;
        const originalConsoleWarn = console.warn;
        const originalConsoleError = console.error;
        
        console.log = function(...args) {
            const message = args.join(' ');
            if (message.includes('üéØ') || message.includes('üõ°Ô∏è') || message.includes('üîì')) {
                addLogEntry(message, 'focus');
            } else if (message.includes('‚ö°') || message.includes('üîß') || message.includes('‚è∏Ô∏è')) {
                addLogEntry(message, 'performance');
            }
            originalConsoleLog.apply(console, args);
        };
        
        console.warn = function(...args) {
            addLogEntry(args.join(' '), 'warning');
            originalConsoleWarn.apply(console, args);
        };
        
        console.error = function(...args) {
            addLogEntry(args.join(' '), 'error');
            originalConsoleError.apply(console, args);
        };
        
        // –ó–∞–ø—É—Å–∫–∞–µ–º –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥
        debugInterval = setInterval(updateFocusStatus, 100);
        
        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è
        addLogEntry('üîç Focus system debug tool initialized', 'info');
        updateFocusStatus();
        
        // –û—á–∏—Å—Ç–∫–∞ –ø—Ä–∏ –∑–∞–∫—Ä—ã—Ç–∏–∏ —Å—Ç—Ä–∞–Ω–∏—Ü—ã
        window.addEventListener('beforeunload', () => {
            if (debugInterval) {
                clearInterval(debugInterval);
            }
        });
    </script>
</body>
</html>